
<!doctype html>
<html lang="zh" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
      
        <link rel="next" href="../ROS%E8%BF%9B%E9%98%B6/">
      
      <link rel="icon" href="../assets/logo.png">
      <meta name="generator" content="mkdocs-1.5.2, mkdocs-material-9.1.21">
    
    
      
        <title>ROS基础 - VK-Robot-Learning-ROS</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.eebd395e.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.ecc896b0.min.css">
      
      

    
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="blue" data-md-color-accent="light-blue">
  
    
    
      <script>var palette=__md_get("__palette");if(palette&&"object"==typeof palette.color)for(var key of Object.keys(palette.color))document.body.setAttribute("data-md-color-"+key,palette.color[key])</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#1-linux" class="md-skip">
          跳转至
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="页眉">
    <a href=".." title="VK-Robot-Learning-ROS" class="md-header__button md-logo" aria-label="VK-Robot-Learning-ROS" data-md-component="logo">
      
  <img src="../assets/logo.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            VK-Robot-Learning-ROS
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              ROS基础
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
          
            
            
            
            <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="blue" data-md-color-accent="light-blue"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_1">
            
              <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_2" hidden>
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 7H7a5 5 0 0 0-5 5 5 5 0 0 0 5 5h10a5 5 0 0 0 5-5 5 5 0 0 0-5-5m0 8a3 3 0 0 1-3-3 3 3 0 0 1 3-3 3 3 0 0 1 3 3 3 3 0 0 1-3 3Z"/></svg>
              </label>
            
          
            
            
            
            <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="blue" data-md-color-accent="light-blue"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_2">
            
              <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_1" hidden>
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 6H7c-3.31 0-6 2.69-6 6s2.69 6 6 6h10c3.31 0 6-2.69 6-6s-2.69-6-6-6zm0 10H7c-2.21 0-4-1.79-4-4s1.79-4 4-4h10c2.21 0 4 1.79 4 4s-1.79 4-4 4zM7 9c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3z"/></svg>
              </label>
            
          
        </form>
      
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="搜索" placeholder="搜索" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="查找">
        
        <button type="reset" class="md-search__icon md-icon" title="清空当前内容" aria-label="清空当前内容" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            正在初始化搜索引擎
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
                
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="导航栏" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="VK-Robot-Learning-ROS" class="md-nav__button md-logo" aria-label="VK-Robot-Learning-ROS" data-md-component="logo">
      
  <img src="../assets/logo.png" alt="logo">

    </a>
    VK-Robot-Learning-ROS
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
    
  
  
    
      
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1" checked>
      
      
        
          
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_1" id="__nav_1_label" tabindex="0">
          智能机器人技术应用
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_1_label" aria-expanded="true">
        <label class="md-nav__title" for="__nav_1">
          <span class="md-nav__icon md-icon"></span>
          智能机器人技术应用
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          ROS基础
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        ROS基础
      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="目录">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      目录
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#11" class="md-nav__link">
    1.1 简介
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#12" class="md-nav__link">
    1.2 主要的发行版本
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#13-ubuntu" class="md-nav__link">
    1.3 安装Ubuntu
  </a>
  
    <nav class="md-nav" aria-label="1.3 安装Ubuntu">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#131" class="md-nav__link">
    1.3.1 安装虚拟机
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#132-ubuntu" class="md-nav__link">
    1.3.2 添加Ubuntu镜像
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#133-ubuntu" class="md-nav__link">
    1.3.3 安装Ubuntu
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#14" class="md-nav__link">
    1.4 目录结构
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#15" class="md-nav__link">
    1.5 常用命令
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../ROS%E8%BF%9B%E9%98%B6/" class="md-nav__link">
        ROS进阶
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../%E5%BB%BA%E5%9B%BE%E4%B8%8E%E5%AF%BC%E8%88%AA/" class="md-nav__link">
        建图与导航
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
                
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" hidden>
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="目录">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      目录
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#11" class="md-nav__link">
    1.1 简介
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#12" class="md-nav__link">
    1.2 主要的发行版本
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#13-ubuntu" class="md-nav__link">
    1.3 安装Ubuntu
  </a>
  
    <nav class="md-nav" aria-label="1.3 安装Ubuntu">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#131" class="md-nav__link">
    1.3.1 安装虚拟机
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#132-ubuntu" class="md-nav__link">
    1.3.2 添加Ubuntu镜像
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#133-ubuntu" class="md-nav__link">
    1.3.3 安装Ubuntu
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#14" class="md-nav__link">
    1.4 目录结构
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#15" class="md-nav__link">
    1.5 常用命令
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


<h1 id="1-linux">1 Linux操作系统基础</h1>
<h2 id="11">1.1 简介</h2>
<p>Linux，全称GNU/Linux，是一套免费使用和自由传播的类Unix操作系统，是一个多用户、多任务、支持多线程和多CPU的操作系统。
伴随着互联网的发展，Linux得到了来自全世界软件爱好者、组织、公司的支持。它除了在服务器方面保持着强劲的发展势头以外，在个人电脑、嵌入式系统上都有着长足的进步。使用者不仅可以直观地获取该操作系统的实现机制，而且可以根据自身的需要来修改完善Linux，使其最大化地适应用户的需要。
Linux不仅系统性能稳定，而且是开源软件。其核心防火墙组件性能高效、配置简单，保证了系统的安全。在很多企业网络中，为了追求速度和安全，Linux不仅仅是被网络运维人员当作服务器使用，甚至当作网络防火墙，这是Linux的一大亮点。
Linux具有开放源码、没有版权、技术社区用户多等特点，开放源码使得用户可以自由裁剪，灵活性高，功能强大，成本低。尤其系统中内嵌网络协议栈，经过适当的配置就可实现路由器的功能。这些特点使得Linux成为开发路由交换设备的理想开发平台。</p>
<figure>
<p><img alt="Linux Logo" src="../assets/b8389b504fc2d562853535047a5b87ef76c6a6efc68d.png" width="300" /></p>
</figure>
<h2 id="12">1.2 主要的发行版本</h2>
<figure>
<table>
<thead>
<tr>
<th style="text-align: center;">Method</th>
<th style="text-align: center;">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: center;"><code>debian</code></td>
<td style="text-align: center;"><img alt="Debian" src="../assets/image-20230424171302822.png" width="200" /></td>
</tr>
<tr>
<td style="text-align: center;"><code>redhat</code></td>
<td style="text-align: center;"><img alt="Redhat" src="../assets/image-20230424171322588.png" width="200" /></td>
</tr>
<tr>
<td style="text-align: center;"><code>gentoo</code></td>
<td style="text-align: center;"><img alt="Gentoo" src="../assets/image-20230424171332108.png" width="200" /></td>
</tr>
<tr>
<td style="text-align: center;"><code>fedora</code></td>
<td style="text-align: center;"><img alt="Fedora" src="../assets/image-20230424171359014.png" width="200" /></td>
</tr>
<tr>
<td style="text-align: center;"><code>ubuntu</code></td>
<td style="text-align: center;"><img alt="Ubuntu" src="../assets/image-20230424171405444.png" width="200" /></td>
</tr>
</tbody>
</table>
</figure>
<h2 id="13-ubuntu">1.3 安装Ubuntu</h2>
<h3 id="131">1.3.1 安装虚拟机</h3>
<p><strong>1.下载 virtualbox</strong></p>
<p>访问官网，下载安装包，官网下载地址：<a href="https://www.virtualbox.org/wiki/Downloads">VirtualBox</a></p>
<figure>
<p><img alt="" src="../assets/image-20230516165231428.png" width="700" /></p>
</figure>
<p><strong>2.安装 virtualbox</strong></p>
<p>virtualbox 安装比较简单，双击下载好的安装文件，一直 "下一步" 即可。（可自行修改安装路径）</p>
<p><strong>3.添加虚拟机</strong></p>
<figure>
<p><img alt="" src="../assets/image-20230516165633426.png" width="700" /></p>
<p><img alt="" src="../assets/image-20230516165744287.png" width="700" /></p>
<p><img alt="" src="../assets/image-20230516165852698.png" width="700" /></p>
<p><img alt="" src="../assets/image-20230516165957373.png" width="700" /></p>
</figure>
<h3 id="132-ubuntu">1.3.2 添加Ubuntu镜像</h3>
<figure>
<p><img alt="" src="../assets/image-20230516170617623.png" width="700" /></p>
<p><img alt="" src="../assets/image-20230516170721434.png" width="700" /></p>
<p><img alt="" src="../assets/image-20230516170827858.png" width="700" /></p>
<p><img alt="" src="../assets/image-20230516171030755.png" width="700" /></p>
</figure>
<blockquote>
<p>镜像下载地址：<a href="http://mirrors.aliyun.com/ubuntu-releases/18.04.6/?spm=a2c6h.25603864.0.0.53c74dda4JflW2">ubuntu-releases-18.04.6安装包下载_开源镜像站-阿里云 (aliyun.com)</a> —— ubuntu-18.04.6-desktop-amd64.iso</p>
</blockquote>
<figure>
<p><img alt="" src="../assets/image-20230516171319848.png" width="700" /></p>
</figure>
<h3 id="133-ubuntu">1.3.3 安装Ubuntu</h3>
<figure>
<p><img alt="" src="../assets/image-20230517084734274.png" width="700" /></p>
<p><img alt="" src="../assets/image-20230517084739432.png" width="700" /></p>
<p><img alt="" src="../assets/image-20230517084745515.png" width="700" /></p>
<p><img alt="" src="../assets/image-20230517084751588.png" width="700" /></p>
<p><img alt="" src="../assets/image-20230517084801193.png" width="700" /></p>
<p><img alt="" src="../assets/image-20230517084806250.png" width="700" /></p>
<p><img alt="" src="../assets/image-20230517084812700.png" width="700" /></p>
<p><img alt="" src="../assets/image-20230517084830076.png" width="700" /></p>
</figure>
<p>等待安装完成，重启电脑，进行账号登录即可进入Ubuntu系统桌面</p>
<h2 id="14">1.4 目录结构</h2>
<p>Linux的操作大部分都是直接执行命令，没有便利的可视化操作界面，所以我们对Linux的操作大多数时候都是通过终端的方式与系统进行交互。</p>
<blockquote>
<p>终端是用户与系统交互使用的命令行界面，可使用快捷键 <span class="keys"><kbd class="key-control">Ctrl</kbd><span>+</span><kbd class="key-alt">Alt</kbd><span>+</span><kbd class="key-t">T</kbd></span> 打开</p>
</blockquote>
<p>Linux的文件系统是采用级层式的树状目录结构，在此结构中的最上层是根目录“/”，然后在此目录下再创建其他的目录。在Linux世界里，一切皆文件。</p>
<p><img alt="Linux目录结构" src="../assets/Linux%E7%9B%AE%E5%BD%95%E7%BB%93%E6%9E%84.png" /></p>
<ul>
<li><strong>root</strong>：该目录为系统管理员目录，root是具有超级权限的用户</li>
<li><strong>bin</strong> ：存放系统预装的二进制（binary）可执行程序，这里存放的可执行文件可以在系统的任何目录下执行</li>
<li><strong>boot</strong>：启动（boot）时用到的核心配置文件</li>
<li><strong>dev</strong>：设备（device）文件</li>
<li><strong>etc</strong>：存放系统管理所需的配置文件、启动脚本等（etc）</li>
<li><strong>home</strong>：本地用户主（home）目录</li>
<li><strong>var</strong>：经常变化的（variable）文件，例如日志或数据库等</li>
<li><strong>lib</strong>：系统库（libraries）文件，存放最基本的动态链接共享库，几乎所有的应用程序都要用到该目录下的文件</li>
<li><strong>usr</strong>：包含绝大部分所有用户（users）都能访问的应用程序和文件</li>
</ul>
<h2 id="15">1.5 常用命令</h2>
<blockquote>
<p>常用的终端工具terminator，可使用以下命令进行安装</p>
<p><code>sudo apt install terminator</code></p>
<p>终端启动快捷键：<span class="keys"><kbd class="key-control">Ctrl</kbd><span>+</span><kbd class="key-alt">Alt</kbd><span>+</span><kbd class="key-t">T</kbd></span>
</p>
</blockquote>
<ul>
<li><strong>pwd</strong>： pwd（Print Working Directory）命令用于显示当前的工作目录</li>
</ul>
<div class="language-shell highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a>vkrobot@vkrobot：~$<span class="w"> </span><span class="nb">pwd</span>
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a>/home/vkrobot
</span></code></pre></div>
<ul>
<li><strong>ls</strong>： ls（List）命令用于显示指定工作目录之下的内容</li>
</ul>
<div class="language-shell highlight"><pre><span></span><code><span id="__span-1-1"><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a>vkrobot@vkrobot：~$<span class="w"> </span>ls<span class="w"> </span>--help
</span><span id="__span-1-2"><a id="__codelineno-1-2" name="__codelineno-1-2" href="#__codelineno-1-2"></a>用法：ls<span class="o">[</span>选项<span class="o">]</span>...<span class="o">[</span>文件<span class="o">]</span>...
</span><span id="__span-1-3"><a id="__codelineno-1-3" name="__codelineno-1-3" href="#__codelineno-1-3"></a>List<span class="w"> </span>information<span class="w"> </span>about<span class="w"> </span>the<span class="w"> </span>FILES<span class="w"> </span><span class="o">(</span>the<span class="w"> </span>current<span class="w"> </span>directory<span class="w"> </span>by<span class="w"> </span>default<span class="o">)</span>.
</span><span id="__span-1-4"><a id="__codelineno-1-4" name="__codelineno-1-4" href="#__codelineno-1-4"></a>
</span><span id="__span-1-5"><a id="__codelineno-1-5" name="__codelineno-1-5" href="#__codelineno-1-5"></a>-a,<span class="w"> </span>-all<span class="w">  </span>不隐藏任何以.<span class="w"> </span>开始的项目
</span><span id="__span-1-6"><a id="__codelineno-1-6" name="__codelineno-1-6" href="#__codelineno-1-6"></a>-l<span class="w">        </span>使用较长格式列出信息
</span><span id="__span-1-7"><a id="__codelineno-1-7" name="__codelineno-1-7" href="#__codelineno-1-7"></a>...
</span><span id="__span-1-8"><a id="__codelineno-1-8" name="__codelineno-1-8" href="#__codelineno-1-8"></a>
</span><span id="__span-1-9"><a id="__codelineno-1-9" name="__codelineno-1-9" href="#__codelineno-1-9"></a>vkrobot@vkrobot：~$<span class="w"> </span>ls<span class="w"> </span>-al
</span></code></pre></div>
<ul>
<li><strong>cd</strong>： cd（Change Directory）命令用于切换目录，变换工作目录至 dirName，其中 dirName 为绝对路径或相对路径</li>
</ul>
<div class="language-shell highlight"><pre><span></span><code><span id="__span-2-1"><a id="__codelineno-2-1" name="__codelineno-2-1" href="#__codelineno-2-1"></a>vkrobot@vkrobot：~$<span class="w"> </span><span class="nb">pwd</span>
</span><span id="__span-2-2"><a id="__codelineno-2-2" name="__codelineno-2-2" href="#__codelineno-2-2"></a>/home/vkrobot
</span><span id="__span-2-3"><a id="__codelineno-2-3" name="__codelineno-2-3" href="#__codelineno-2-3"></a>vkrobot@vkrobot：~$<span class="w"> </span><span class="nb">cd</span><span class="w"> </span>..
</span><span id="__span-2-4"><a id="__codelineno-2-4" name="__codelineno-2-4" href="#__codelineno-2-4"></a>vkrobot@vkrobot：~$<span class="w"> </span><span class="nb">pwd</span>
</span><span id="__span-2-5"><a id="__codelineno-2-5" name="__codelineno-2-5" href="#__codelineno-2-5"></a>/home
</span><span id="__span-2-6"><a id="__codelineno-2-6" name="__codelineno-2-6" href="#__codelineno-2-6"></a>vkrobot@vkrobot：~$<span class="w"> </span><span class="nb">cd</span><span class="w"> </span>/
</span><span id="__span-2-7"><a id="__codelineno-2-7" name="__codelineno-2-7" href="#__codelineno-2-7"></a>vkrobot@vkrobot：~$<span class="w"> </span><span class="nb">pwd</span>
</span><span id="__span-2-8"><a id="__codelineno-2-8" name="__codelineno-2-8" href="#__codelineno-2-8"></a>/
</span></code></pre></div>
<ul>
<li><strong>clear</strong>： clear命令用于清屏</li>
<li><strong>mkdir</strong>： mkdir（Make Directory）命令用于创建目录（文件夹）</li>
</ul>
<div class="language-shell highlight"><pre><span></span><code><span id="__span-3-1"><a id="__codelineno-3-1" name="__codelineno-3-1" href="#__codelineno-3-1"></a>vkrobot@vkrobot：~$<span class="w"> </span>mkdir<span class="w"> </span>--help
</span><span id="__span-3-2"><a id="__codelineno-3-2" name="__codelineno-3-2" href="#__codelineno-3-2"></a>用法：mkdir<span class="w"> </span><span class="o">[</span>选项<span class="o">]</span>...<span class="w"> </span>目录...
</span><span id="__span-3-3"><a id="__codelineno-3-3" name="__codelineno-3-3" href="#__codelineno-3-3"></a>Create<span class="w"> </span>the<span class="w"> </span>DIRECTORT<span class="o">(</span>ies<span class="o">)</span>,<span class="w"> </span><span class="k">if</span><span class="w"> </span>they<span class="w"> </span><span class="k">do</span><span class="w"> </span>not<span class="w"> </span>exist.
</span></code></pre></div>
<ul>
<li><strong>touch</strong>： touch命令用于创建文件</li>
</ul>
<div class="language-shell highlight"><pre><span></span><code><span id="__span-4-1"><a id="__codelineno-4-1" name="__codelineno-4-1" href="#__codelineno-4-1"></a>vkrobot@vkrobot：~$<span class="w"> </span>touch<span class="w"> </span>--help
</span><span id="__span-4-2"><a id="__codelineno-4-2" name="__codelineno-4-2" href="#__codelineno-4-2"></a>用法：touch<span class="w"> </span><span class="o">[</span>选项<span class="o">]</span>...<span class="w"> </span>文件...
</span><span id="__span-4-3"><a id="__codelineno-4-3" name="__codelineno-4-3" href="#__codelineno-4-3"></a>A<span class="w"> </span>FILE<span class="w"> </span>argument<span class="w"> </span>that<span class="w"> </span>dose<span class="w"> </span>not<span class="w"> </span>exist<span class="w"> </span>is<span class="w"> </span>creared<span class="w"> </span>empty
</span></code></pre></div>
<ul>
<li><strong>rm</strong>： rm（Remove）命令用于删除目录（文件夹）或文件</li>
</ul>
<div class="language-shell highlight"><pre><span></span><code><span id="__span-5-1"><a id="__codelineno-5-1" name="__codelineno-5-1" href="#__codelineno-5-1"></a>vkrobot@vkrobot：~$<span class="w"> </span>rm<span class="w"> </span>--help
</span><span id="__span-5-2"><a id="__codelineno-5-2" name="__codelineno-5-2" href="#__codelineno-5-2"></a>用法：rm<span class="w"> </span><span class="o">[</span>选项<span class="o">]</span>...<span class="w"> </span><span class="o">[</span>文件<span class="o">]</span>...
</span><span id="__span-5-3"><a id="__codelineno-5-3" name="__codelineno-5-3" href="#__codelineno-5-3"></a>Remove<span class="w"> </span><span class="o">(</span>unlink<span class="o">)</span><span class="w"> </span>the<span class="w"> </span>FILE<span class="o">(</span>s<span class="o">)</span>.
</span><span id="__span-5-4"><a id="__codelineno-5-4" name="__codelineno-5-4" href="#__codelineno-5-4"></a>
</span><span id="__span-5-5"><a id="__codelineno-5-5" name="__codelineno-5-5" href="#__codelineno-5-5"></a>-r,<span class="w"> </span>-R,<span class="w"> </span>--recursive<span class="w">  </span>remove<span class="w"> </span>directories<span class="w"> </span>and<span class="w"> </span>their<span class="w"> </span>contents<span class="w"> </span>recusively
</span><span id="__span-5-6"><a id="__codelineno-5-6" name="__codelineno-5-6" href="#__codelineno-5-6"></a>-d,<span class="w"> </span>--dir<span class="w">            </span>remove<span class="w"> </span>empty<span class="w"> </span>directories
</span></code></pre></div>
<ul>
<li><strong>chmod</strong>： chmod命令用于变更文件或目录的权限。在Linux中，文件或目录权限的控制分别以读取(r/4)、写入(w/2)、执行(x/1)三种权限来区分</li>
</ul>
<div class="language-shell highlight"><pre><span></span><code><span id="__span-6-1"><a id="__codelineno-6-1" name="__codelineno-6-1" href="#__codelineno-6-1"></a>vkrobot@vkrobot：~$<span class="w"> </span>chmod<span class="w"> </span>--help
</span><span id="__span-6-2"><a id="__codelineno-6-2" name="__codelineno-6-2" href="#__codelineno-6-2"></a>用法：chmod<span class="w"> </span><span class="o">[</span>选项<span class="o">]</span>...<span class="w"> </span>模式<span class="o">[</span>,模式<span class="o">]</span>...<span class="w"> </span>文件...
</span><span id="__span-6-3"><a id="__codelineno-6-3" name="__codelineno-6-3" href="#__codelineno-6-3"></a>Change<span class="w"> </span>the<span class="w"> </span>mode<span class="w"> </span>of<span class="w"> </span>each<span class="w"> </span>FILE<span class="w"> </span>to<span class="w"> </span>MODE.
</span></code></pre></div>
<ul>
<li><strong>sudo</strong>： sudo是允许系统管理员让普通用户执行一些或全部的root命令的一个工具，也就是暂时提升普通用户的权限</li>
</ul>
<h1 id="2-ros">2 ROS编程基础</h1>
<h2 id="21-ros">2.1 ROS是什么</h2>
<p>ROS (Robot Operating System, 机器人操作系统) 提供一系列程序库和工具以帮助软件开发者创建机器人应用软件。它提供了硬件抽象、设备驱动、函数库、可视化工具、消息传递和软件包管理等诸多功能。ROS遵循BSD开源许可协议。</p>
<figure>
<p><img alt="" src="http://www.autolabor.com.cn/book/ROSTutorials/.\assets/13_%E5%89%8D%E8%A8%80.png" /></p>
</figure>
<p>ROS设计者将ROS表述为“ROS = Plumbing + Tools + Capabilities + Ecosystem”，即ROS是通讯机制、工具软件包、机器人高层技能以及机器人生态系统的集合体</p>
<figure>
<p><img alt="" src="../assets/%E5%9B%BE%E7%89%871.png" /></p>
</figure>
<h2 id="22-ros">2.2 ROS安装</h2>
<p><strong>ROS与Ubuntu版本对应关系</strong></p>
<figure>
<table>
<thead>
<tr>
<th style="text-align: center;">ROS版本名称</th>
<th style="text-align: center;">LOGO</th>
<th style="text-align: center;">发布时间</th>
<th style="text-align: center;">支持的操作系统</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: center;">ROS Noetic Ninjemys</td>
<td style="text-align: center;"><img alt="" src="../assets/noetic.png" width="200" /></td>
<td style="text-align: center;">2020/05/23</td>
<td style="text-align: center;">Ubuntu 20.04</td>
</tr>
<tr>
<td style="text-align: center;">ROS Melodic Morenia</td>
<td style="text-align: center;"><img alt="" src="../assets/melodic.jpg" width="200" /></td>
<td style="text-align: center;">2018/05/23</td>
<td style="text-align: center;">Ubuntu 18.04</td>
</tr>
<tr>
<td style="text-align: center;">ROS Lunar Loggerhead</td>
<td style="text-align: center;"><img alt="" src="../assets/lunar.png" width="200" /></td>
<td style="text-align: center;">2017/05/23</td>
<td style="text-align: center;">Ubuntu 16.04</td>
</tr>
<tr>
<td style="text-align: center;">ROS Kinetic Kame</td>
<td style="text-align: center;"><img alt="" src="../assets/kinetic.png" width="200" /></td>
<td style="text-align: center;">2016/05/23</td>
<td style="text-align: center;">Ubuntu 15.10</td>
</tr>
<tr>
<td style="text-align: center;">ROS Jade Turtle</td>
<td style="text-align: center;"><img alt="" src="../assets/jade.png" width="200" /></td>
<td style="text-align: center;">2015/05/23</td>
<td style="text-align: center;">Ubuntu 14.04</td>
</tr>
<tr>
<td style="text-align: center;">......</td>
<td style="text-align: center;">......</td>
<td style="text-align: center;">......</td>
<td style="text-align: center;">......</td>
</tr>
</tbody>
</table>
</figure>
<ol>
<li>配置Ubuntu软件仓库</li>
</ol>
<p>打开“软件和更新”配置你的Ubuntu软件仓库（repositories）以允许使用 “restricted”、“universe” 和 “multiverse” 存储库。</p>
<figure>
<p><img alt="" src="../assets/image-20230518180247219.png" width="500" /></p>
</figure>
<ol>
<li>设置sources.list</li>
</ol>
<div class="language-shell highlight"><pre><span></span><code><span id="__span-7-1"><a id="__codelineno-7-1" name="__codelineno-7-1" href="#__codelineno-7-1"></a>vkrobot@vkrobot：~$<span class="w"> </span>sudo<span class="w"> </span>sh<span class="w"> </span>-c<span class="w"> </span><span class="s1">&#39;. /etc/lsb-release &amp;&amp; echo &quot;deb http://mirrors.tuna.tsinghua.edu.cn/ros/ubuntu/ `lsb_release -cs` main&quot; &gt; /etc/apt/sources.list.d/ros-latest.list&#39;</span>
</span></code></pre></div>
<ol>
<li>设置密钥</li>
</ol>
<div class="language-shell highlight"><pre><span></span><code><span id="__span-8-1"><a id="__codelineno-8-1" name="__codelineno-8-1" href="#__codelineno-8-1"></a>vkrobot@vkrobot：~$<span class="w"> </span>sudo<span class="w"> </span>apt-key<span class="w"> </span>adv<span class="w"> </span>--keyserver<span class="w"> </span><span class="s1">&#39;hkp：//keyserver.ubuntu.com：80&#39;</span><span class="w"> </span>--recv-key<span class="w"> </span>C1CF6E31E6BADE8868B172B4F42ED6FBAB17C654
</span></code></pre></div>
<ol>
<li>安装</li>
</ol>
<div class="language-shell highlight"><pre><span></span><code><span id="__span-9-1"><a id="__codelineno-9-1" name="__codelineno-9-1" href="#__codelineno-9-1"></a>vkrobot@vkrobot：~$<span class="w"> </span>sudo<span class="w"> </span>apt<span class="w"> </span>update
</span><span id="__span-9-2"><a id="__codelineno-9-2" name="__codelineno-9-2" href="#__codelineno-9-2"></a>vkrobot@vkrobot：~$<span class="w"> </span>sudo<span class="w"> </span>apt<span class="w"> </span>install<span class="w"> </span>ros-melodic-desktop-full
</span></code></pre></div>
<ol>
<li>初始化rosdep</li>
</ol>
<div class="language-shell highlight"><pre><span></span><code><span id="__span-10-1"><a id="__codelineno-10-1" name="__codelineno-10-1" href="#__codelineno-10-1"></a>vkrobot@vkrobot：~$<span class="w"> </span>sudo<span class="w"> </span>apt-get<span class="w"> </span>install<span class="w"> </span>python3-pip
</span><span id="__span-10-2"><a id="__codelineno-10-2" name="__codelineno-10-2" href="#__codelineno-10-2"></a>vkrobot@vkrobot：~$<span class="w"> </span>sudo<span class="w"> </span>pip3<span class="w"> </span>install<span class="w"> </span>rosdepc
</span><span id="__span-10-3"><a id="__codelineno-10-3" name="__codelineno-10-3" href="#__codelineno-10-3"></a>vkrobot@vkrobot：~$<span class="w"> </span>sudo<span class="w"> </span>rosdepc<span class="w"> </span>init
</span><span id="__span-10-4"><a id="__codelineno-10-4" name="__codelineno-10-4" href="#__codelineno-10-4"></a>vkrobot@vkrobot：~$<span class="w"> </span>rosdepc<span class="w"> </span>update
</span><span id="__span-10-5"><a id="__codelineno-10-5" name="__codelineno-10-5" href="#__codelineno-10-5"></a>vkrobot@vkrobot：~$<span class="w"> </span>sudo<span class="w"> </span>chmod<span class="w"> </span>-R<span class="w"> </span><span class="m">777</span><span class="w"> </span>~/.ros/
</span></code></pre></div>
<ol>
<li>设置环境</li>
</ol>
<div class="language-shell highlight"><pre><span></span><code><span id="__span-11-1"><a id="__codelineno-11-1" name="__codelineno-11-1" href="#__codelineno-11-1"></a>vkrobot@vkrobot：~$<span class="w"> </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;source /opt/ros/melodic/setup.bash&quot;</span><span class="w"> </span>&gt;&gt;<span class="w"> </span>~/.bashrc
</span><span id="__span-11-2"><a id="__codelineno-11-2" name="__codelineno-11-2" href="#__codelineno-11-2"></a>vkrobot@vkrobot：~$<span class="w"> </span><span class="nb">source</span><span class="w"> </span>~/.bashrc
</span></code></pre></div>
<ol>
<li>构建依赖</li>
</ol>
<div class="language-shell highlight"><pre><span></span><code><span id="__span-12-1"><a id="__codelineno-12-1" name="__codelineno-12-1" href="#__codelineno-12-1"></a>vkrobot@vkrobot：~$<span class="w"> </span>sudo<span class="w"> </span>apt-get<span class="w"> </span>install<span class="w"> </span>python-rosinstall<span class="w"> </span>python-rosinstall-generator<span class="w"> </span>python-wstool<span class="w"> </span>build-essential
</span></code></pre></div>
<blockquote>
<p>使用以下命令检查ROS是否安装成功：</p>
<p><code>roscore</code></p>
</blockquote>
<h2 id="23-ros">2.3 ROS的核心概念</h2>
<p>计算图（Computation Graph）是一个由ROS进程组成的点对点网络，它们能够共同处理数据。ROS的基本计算图概念有节点（Nodes）、主节点（Master）、参数服务器（Parameter Server）、消息（Messages）、服务（Services）、话题（Topics）和袋（Bags），它们都以不同的方式向图（Graph）提供数据。</p>
<ul>
<li>节点（Nodes）：节点是一个可执行文件，它通过ROS来与其他节点进行通信。</li>
<li>主节点（Master）：ROS的命名服务，例如帮助节点发现彼此。</li>
<li>消息（Messages）：订阅或发布话题时所使用的ROS数据类型。</li>
<li>话题（Topics）：节点可以将消息发布到话题，或通过订阅话题来接收消息。</li>
</ul>
<blockquote>
<p>使用 <code>rqt_graph</code> 命令能够创建一个显示当前系统ROS程序运行情况的动态图形，显示不同节点之间的关系</p>
</blockquote>
<figure>
<p><img alt="http://ros.org/images/wiki/ROS_basic_concepts.png" src="http://ros.org/images/wiki/ROS_basic_concepts.png" width="300" /></p>
</figure>
<h3 id="231">2.3.1 节点与主节点</h3>
<h4 id="nodes">节点（Nodes）</h4>
<p>节点实际上只不过是ROS软件包中的一个可执行文件。ROS节点使用ROS客户端库与其他节点通信。节点可以发布或订阅话题，也可以提供或使用服务。</p>
<p><strong>特点：</strong></p>
<ul>
<li>不同节点可使用不同语言编写，分布式部署在不同的主机上</li>
<li>节点在系统中的名称必须是唯一的</li>
</ul>
<blockquote>
<p>例如，咱们有一个机器人，和一个遥控器，那么这个机器人和遥控器开始工作后，就是两个节点。遥控器起到了下达指令的作用；机器人负责监听遥控器下达的指令，完成相应动作。从这里我们可以看出，节点是一个能执行特定工作任 务的工作单元，并且能够相互通信，从而实现一个机器人系统整体的功能。在这里我们把遥控器和机器人简单定义为两个节点，实际上在机器人中根据控制器、传感器、执行机构等不同组成模块，还可以将其进一步细分为更多的节点，这个是根据用户编写的程序来定义的。）</p>
</blockquote>
<p><strong>客户端库：</strong>ROS客户端库可以让用不同编程语言编写的节点进行相互通信</p>
<ul>
<li><strong>rospy</strong>： Python客户端库</li>
<li><strong>roscpp</strong>： C++客户端库</li>
</ul>
<h4 id="master">主节点（Master）</h4>
<p><code>roscore</code>是你在运行所有ROS程序前首先要运行的命令</p>
<div class="language-shell highlight"><pre><span></span><code><span id="__span-13-1"><a id="__codelineno-13-1" name="__codelineno-13-1" href="#__codelineno-13-1"></a>vkrobot@vkrobot：~$<span class="w"> </span>roscore
</span></code></pre></div>
<p>然后你会看到类似下面的输出信息：</p>
<div class="language-shell highlight"><pre><span></span><code><span id="__span-14-1"><a id="__codelineno-14-1" name="__codelineno-14-1" href="#__codelineno-14-1"></a>...<span class="w"> </span>logging<span class="w"> </span>to<span class="w"> </span>~/.ros/log/9cf88ce4-b14d-11df-8a75-00251148e8cf/roslaunch-machine_name-13039.log
</span><span id="__span-14-2"><a id="__codelineno-14-2" name="__codelineno-14-2" href="#__codelineno-14-2"></a>Checking<span class="w"> </span>log<span class="w"> </span>directory<span class="w"> </span><span class="k">for</span><span class="w"> </span>disk<span class="w"> </span>usage.<span class="w"> </span>This<span class="w"> </span>may<span class="w"> </span>take<span class="w"> </span>awhile.
</span><span id="__span-14-3"><a id="__codelineno-14-3" name="__codelineno-14-3" href="#__codelineno-14-3"></a>Press<span class="w"> </span>Ctrl-C<span class="w"> </span>to<span class="w"> </span>interrupt
</span><span id="__span-14-4"><a id="__codelineno-14-4" name="__codelineno-14-4" href="#__codelineno-14-4"></a>Done<span class="w"> </span>checking<span class="w"> </span>log<span class="w"> </span>file<span class="w"> </span>disk<span class="w"> </span>usage.<span class="w"> </span>Usage<span class="w"> </span>is<span class="w"> </span>&lt;1GB.
</span><span id="__span-14-5"><a id="__codelineno-14-5" name="__codelineno-14-5" href="#__codelineno-14-5"></a>
</span><span id="__span-14-6"><a id="__codelineno-14-6" name="__codelineno-14-6" href="#__codelineno-14-6"></a>started<span class="w"> </span>roslaunch<span class="w"> </span>server<span class="w"> </span>http://machine_name：33919/
</span><span id="__span-14-7"><a id="__codelineno-14-7" name="__codelineno-14-7" href="#__codelineno-14-7"></a>ros_comm<span class="w"> </span>version<span class="w"> </span><span class="m">1</span>.4.7
</span><span id="__span-14-8"><a id="__codelineno-14-8" name="__codelineno-14-8" href="#__codelineno-14-8"></a>
</span><span id="__span-14-9"><a id="__codelineno-14-9" name="__codelineno-14-9" href="#__codelineno-14-9"></a>SUMMARY
</span><span id="__span-14-10"><a id="__codelineno-14-10" name="__codelineno-14-10" href="#__codelineno-14-10"></a>
</span><span id="__span-14-11"><a id="__codelineno-14-11" name="__codelineno-14-11" href="#__codelineno-14-11"></a>
</span><span id="__span-14-12"><a id="__codelineno-14-12" name="__codelineno-14-12" href="#__codelineno-14-12"></a>PARAMETERS
</span><span id="__span-14-13"><a id="__codelineno-14-13" name="__codelineno-14-13" href="#__codelineno-14-13"></a><span class="w"> </span>*<span class="w"> </span>/rosdistro：<span class="w"> </span>melodic
</span><span id="__span-14-14"><a id="__codelineno-14-14" name="__codelineno-14-14" href="#__codelineno-14-14"></a><span class="w"> </span>*<span class="w"> </span>/rosversion：<span class="w"> </span><span class="m">1</span>.14.13
</span><span id="__span-14-15"><a id="__codelineno-14-15" name="__codelineno-14-15" href="#__codelineno-14-15"></a>
</span><span id="__span-14-16"><a id="__codelineno-14-16" name="__codelineno-14-16" href="#__codelineno-14-16"></a>NODES
</span><span id="__span-14-17"><a id="__codelineno-14-17" name="__codelineno-14-17" href="#__codelineno-14-17"></a>
</span><span id="__span-14-18"><a id="__codelineno-14-18" name="__codelineno-14-18" href="#__codelineno-14-18"></a>auto-starting<span class="w"> </span>new<span class="w"> </span>master
</span><span id="__span-14-19"><a id="__codelineno-14-19" name="__codelineno-14-19" href="#__codelineno-14-19"></a>process<span class="o">[</span>master<span class="o">]</span>：<span class="w"> </span>started<span class="w"> </span>with<span class="w"> </span>pid<span class="w"> </span><span class="o">[</span><span class="m">13054</span><span class="o">]</span>
</span><span id="__span-14-20"><a id="__codelineno-14-20" name="__codelineno-14-20" href="#__codelineno-14-20"></a><span class="nv">ROS_MASTER_URI</span><span class="o">=</span>http://machine_name：11311/
</span><span id="__span-14-21"><a id="__codelineno-14-21" name="__codelineno-14-21" href="#__codelineno-14-21"></a>
</span><span id="__span-14-22"><a id="__codelineno-14-22" name="__codelineno-14-22" href="#__codelineno-14-22"></a>setting<span class="w"> </span>/run_id<span class="w"> </span>to<span class="w"> </span>9cf88ce4-b14d-11df-8a75-00251148e8cf
</span><span id="__span-14-23"><a id="__codelineno-14-23" name="__codelineno-14-23" href="#__codelineno-14-23"></a>process<span class="o">[</span>rosout-1<span class="o">]</span>：<span class="w"> </span>started<span class="w"> </span>with<span class="w"> </span>pid<span class="w"> </span><span class="o">[</span><span class="m">13067</span><span class="o">]</span>
</span><span id="__span-14-24"><a id="__codelineno-14-24" name="__codelineno-14-24" href="#__codelineno-14-24"></a>started<span class="w"> </span>core<span class="w"> </span>service<span class="w"> </span><span class="o">[</span>/rosout<span class="o">]</span>
</span></code></pre></div>
<h4 id="rosnode">使用 rosnode</h4>
<p><code>rosnode</code>显示当前正在运行的ROS节点信息。<code>rosnode list</code>命令会列出这些活动的节点：</p>
<div class="language-shell highlight"><pre><span></span><code><span id="__span-15-1"><a id="__codelineno-15-1" name="__codelineno-15-1" href="#__codelineno-15-1"></a>vkrobot@vkrobot：~$<span class="w"> </span>rosnode<span class="w"> </span>list
</span><span id="__span-15-2"><a id="__codelineno-15-2" name="__codelineno-15-2" href="#__codelineno-15-2"></a>/rosout
</span></code></pre></div>
<p>这表示当前只有一个节点在运行： rosout。因为这个节点用于收集和记录节点的调试输出，所以它总是在运行的。</p>
<p><code>rosnode info</code>命令可以返回某个指定节点的信息</p>
<div class="language-shell highlight"><pre><span></span><code><span id="__span-16-1"><a id="__codelineno-16-1" name="__codelineno-16-1" href="#__codelineno-16-1"></a>vkrobot@vkrobot：~$<span class="w"> </span>rosnode<span class="w"> </span>info<span class="w"> </span>/rosout
</span><span id="__span-16-2"><a id="__codelineno-16-2" name="__codelineno-16-2" href="#__codelineno-16-2"></a>--------------------------------------------------------------------
</span><span id="__span-16-3"><a id="__codelineno-16-3" name="__codelineno-16-3" href="#__codelineno-16-3"></a>Node<span class="w"> </span><span class="o">[</span>/rosout<span class="o">]</span>
</span><span id="__span-16-4"><a id="__codelineno-16-4" name="__codelineno-16-4" href="#__codelineno-16-4"></a>Publications：
</span><span id="__span-16-5"><a id="__codelineno-16-5" name="__codelineno-16-5" href="#__codelineno-16-5"></a><span class="w"> </span>*<span class="w"> </span>/rosout_agg<span class="w"> </span><span class="o">[</span>rosgraph_msgs/Log<span class="o">]</span>
</span><span id="__span-16-6"><a id="__codelineno-16-6" name="__codelineno-16-6" href="#__codelineno-16-6"></a>
</span><span id="__span-16-7"><a id="__codelineno-16-7" name="__codelineno-16-7" href="#__codelineno-16-7"></a>Subscriptions：
</span><span id="__span-16-8"><a id="__codelineno-16-8" name="__codelineno-16-8" href="#__codelineno-16-8"></a><span class="w"> </span>*<span class="w"> </span>/rosout<span class="w"> </span><span class="o">[</span>unknown<span class="w"> </span>type<span class="o">]</span>
</span><span id="__span-16-9"><a id="__codelineno-16-9" name="__codelineno-16-9" href="#__codelineno-16-9"></a>
</span><span id="__span-16-10"><a id="__codelineno-16-10" name="__codelineno-16-10" href="#__codelineno-16-10"></a>Services：
</span><span id="__span-16-11"><a id="__codelineno-16-11" name="__codelineno-16-11" href="#__codelineno-16-11"></a><span class="w"> </span>*<span class="w"> </span>/rosout/get_loggers
</span><span id="__span-16-12"><a id="__codelineno-16-12" name="__codelineno-16-12" href="#__codelineno-16-12"></a><span class="w"> </span>*<span class="w"> </span>/rosout/set_logger_level
</span><span id="__span-16-13"><a id="__codelineno-16-13" name="__codelineno-16-13" href="#__codelineno-16-13"></a>
</span><span id="__span-16-14"><a id="__codelineno-16-14" name="__codelineno-16-14" href="#__codelineno-16-14"></a>contacting<span class="w"> </span>node<span class="w"> </span>http://machine_name：54614/<span class="w"> </span>...
</span><span id="__span-16-15"><a id="__codelineno-16-15" name="__codelineno-16-15" href="#__codelineno-16-15"></a>Pid：<span class="w"> </span><span class="m">5092</span>
</span></code></pre></div>
<h4 id="rosrun">使用 rosrun</h4>
<p>rosrun可以让你用包名直接运行软件包内的节点（而不需要知道包的路径）</p>
<p>用法：</p>
<p><code>rosrun [package_name] [node_name]</code></p>
<p>在一个新终端中：</p>
<div class="language-shell highlight"><pre><span></span><code><span id="__span-17-1"><a id="__codelineno-17-1" name="__codelineno-17-1" href="#__codelineno-17-1"></a>vkrobot@vkrobot：~$<span class="w"> </span>rosrun<span class="w"> </span>turtlesim<span class="w"> </span>turtlesim_node
</span></code></pre></div>
<figure>
<p><img alt="turtlesim" src="../assets/turtlesim.png" /></p>
</figure>
<blockquote>
<p><strong>注意</strong>：此处的乌龟可能和你turtlesim窗口上的不同。</p>
</blockquote>
<h4 id="_1">复习</h4>
<p>本节所涉及的内容：</p>
<ul>
<li>roscore = ros + core：主节点（为ROS提供命名服务）</li>
<li>rosnode = ros + node：获取节点信息的ROS工具</li>
<li>rosrun = ros + run：运行给定的软件包中的节点</li>
</ul>
<h3 id="232">2.3.2 话题通信</h3>
<figure>
<p><img alt="img" src="../assets/%E8%AF%9D%E9%A2%98%E9%80%9A%E4%BF%A1.png" width="700" /></p>
</figure>
<p>首先确保<code>roscore</code>与<code>turtlesim</code>正在运行</p>
<p>打开一个新终端：</p>
<div class="language-shell highlight"><pre><span></span><code><span id="__span-18-1"><a id="__codelineno-18-1" name="__codelineno-18-1" href="#__codelineno-18-1"></a>vkrobot@vkrobot：~$<span class="w"> </span>rosrun<span class="w"> </span>turtlesim<span class="w"> </span>turtle_teleop_key
</span><span id="__span-18-2"><a id="__codelineno-18-2" name="__codelineno-18-2" href="#__codelineno-18-2"></a>Reading<span class="w"> </span>from<span class="w"> </span>keyboard
</span><span id="__span-18-3"><a id="__codelineno-18-3" name="__codelineno-18-3" href="#__codelineno-18-3"></a>---------------------------
</span><span id="__span-18-4"><a id="__codelineno-18-4" name="__codelineno-18-4" href="#__codelineno-18-4"></a>Use<span class="w"> </span>arrow<span class="w"> </span>keys<span class="w"> </span>to<span class="w"> </span>move<span class="w"> </span>the<span class="w"> </span>turtle.
</span></code></pre></div>
<blockquote>
<p>现在你可以使用键盘上的方向键来控制turtle运动了。如果不能控制，请选中turtle_teleop_key的终端窗口以确保按键输入能够被捕获。</p>
</blockquote>
<figure>
<p><img alt="turtle_key" src="../assets/turtle_key.png" /></p>
</figure>
<p>打开一个新终端：</p>
<div class="language-shell highlight"><pre><span></span><code><span id="__span-19-1"><a id="__codelineno-19-1" name="__codelineno-19-1" href="#__codelineno-19-1"></a>vkrobot@vkrobot：~$<span class="w"> </span>rqt_graph
</span></code></pre></div>
<p>你会看到一个窗口：</p>
<figure>
<p><img alt="rqt_graph_turtle_key2" src="../assets/rqt_graph_turtle_key2.png" width="600" /></p>
</figure>
<h4 id="rostopic">使用 rostopic</h4>
<p><code>rostopic</code>命令工具能让你获取ROS话题的信息。</p>
<p>你可以使用帮助选项查看可用的<code>rostopic</code>的子命令</p>
<div class="language-shell highlight"><pre><span></span><code><span id="__span-20-1"><a id="__codelineno-20-1" name="__codelineno-20-1" href="#__codelineno-20-1"></a>vkrobot@vkrobot：~$<span class="w"> </span>rostopic<span class="w"> </span>--help
</span><span id="__span-20-2"><a id="__codelineno-20-2" name="__codelineno-20-2" href="#__codelineno-20-2"></a>rostopic<span class="w"> </span>is<span class="w"> </span>a<span class="w"> </span>command-line<span class="w"> </span>tool<span class="w"> </span><span class="k">for</span><span class="w"> </span>printing<span class="w"> </span>information<span class="w"> </span>about<span class="w"> </span>ROS<span class="w"> </span>Topics.
</span><span id="__span-20-3"><a id="__codelineno-20-3" name="__codelineno-20-3" href="#__codelineno-20-3"></a>
</span><span id="__span-20-4"><a id="__codelineno-20-4" name="__codelineno-20-4" href="#__codelineno-20-4"></a>Commands：
</span><span id="__span-20-5"><a id="__codelineno-20-5" name="__codelineno-20-5" href="#__codelineno-20-5"></a><span class="w">        </span>rostopic<span class="w"> </span>bw<span class="w">     </span>display<span class="w"> </span>bandwidth<span class="w"> </span>used<span class="w"> </span>by<span class="w"> </span>topic
</span><span id="__span-20-6"><a id="__codelineno-20-6" name="__codelineno-20-6" href="#__codelineno-20-6"></a><span class="w">        </span>rostopic<span class="w"> </span>delay<span class="w">  </span>display<span class="w"> </span>delay<span class="w"> </span>of<span class="w"> </span>topic<span class="w"> </span>from<span class="w"> </span>timestamp<span class="w"> </span><span class="k">in</span><span class="w"> </span>header
</span><span id="__span-20-7"><a id="__codelineno-20-7" name="__codelineno-20-7" href="#__codelineno-20-7"></a><span class="w">        </span>rostopic<span class="w"> </span><span class="nb">echo</span><span class="w">   </span>print<span class="w"> </span>messages<span class="w"> </span>to<span class="w"> </span>screen
</span><span id="__span-20-8"><a id="__codelineno-20-8" name="__codelineno-20-8" href="#__codelineno-20-8"></a><span class="w">        </span>rostopic<span class="w"> </span>find<span class="w">   </span>find<span class="w"> </span>topics<span class="w"> </span>by<span class="w"> </span><span class="nb">type</span>
</span><span id="__span-20-9"><a id="__codelineno-20-9" name="__codelineno-20-9" href="#__codelineno-20-9"></a><span class="w">        </span>rostopic<span class="w"> </span>hz<span class="w">     </span>display<span class="w"> </span>publishing<span class="w"> </span>rate<span class="w"> </span>of<span class="w"> </span>topic<span class="w">    </span>
</span><span id="__span-20-10"><a id="__codelineno-20-10" name="__codelineno-20-10" href="#__codelineno-20-10"></a><span class="w">        </span>rostopic<span class="w"> </span>info<span class="w">   </span>print<span class="w"> </span>information<span class="w"> </span>about<span class="w"> </span>active<span class="w"> </span>topic
</span><span id="__span-20-11"><a id="__codelineno-20-11" name="__codelineno-20-11" href="#__codelineno-20-11"></a><span class="w">        </span>rostopic<span class="w"> </span>list<span class="w">   </span>list<span class="w"> </span>active<span class="w"> </span>topics
</span><span id="__span-20-12"><a id="__codelineno-20-12" name="__codelineno-20-12" href="#__codelineno-20-12"></a><span class="w">        </span>rostopic<span class="w"> </span>pub<span class="w">    </span>publish<span class="w"> </span>data<span class="w"> </span>to<span class="w"> </span>topic
</span><span id="__span-20-13"><a id="__codelineno-20-13" name="__codelineno-20-13" href="#__codelineno-20-13"></a><span class="w">        </span>rostopic<span class="w"> </span><span class="nb">type</span><span class="w">   </span>print<span class="w"> </span>topic<span class="w"> </span>or<span class="w"> </span>field<span class="w"> </span><span class="nb">type</span>
</span><span id="__span-20-14"><a id="__codelineno-20-14" name="__codelineno-20-14" href="#__codelineno-20-14"></a>
</span><span id="__span-20-15"><a id="__codelineno-20-15" name="__codelineno-20-15" href="#__codelineno-20-15"></a>Type<span class="w"> </span>rostopic<span class="w"> </span>&lt;command&gt;<span class="w"> </span>-h<span class="w"> </span><span class="k">for</span><span class="w"> </span>more<span class="w"> </span>detailed<span class="w"> </span>usage,<span class="w"> </span>e.g.<span class="w"> </span><span class="s1">&#39;rostopic echo -h&#39;</span>
</span></code></pre></div>
<h5 id="rostopic-echo">rostopic echo</h5>
<p><code>rostopic echo</code>可以显示在某个话题上发布的数据。</p>
<p>用法：<code>rostopic echo [topic]</code></p>
<div class="language-shell highlight"><pre><span></span><code><span id="__span-21-1"><a id="__codelineno-21-1" name="__codelineno-21-1" href="#__codelineno-21-1"></a>vkrobot@vkrobot：~$<span class="w"> </span>rostopic<span class="w"> </span><span class="nb">echo</span><span class="w"> </span>/turtle1/cmd_vel
</span></code></pre></div>
<blockquote>
<p>你可能会看到什么都没发生，因为现在还没有数据被发布到该话题上。可以通过按下键盘方向键让<code>turtle_teleop_key</code>节点发布数据。记得如果不能控制乌龟，请选中turtle_teleop_key的终端窗口以确保按键输入能够被捕获。</p>
</blockquote>
<h5 id="rostopic-list">rostopic list</h5>
<p><code>rostopic list</code>能够列出当前已被订阅和发布的所有话题。</p>
<div class="language-shell highlight"><pre><span></span><code><span id="__span-22-1"><a id="__codelineno-22-1" name="__codelineno-22-1" href="#__codelineno-22-1"></a>vkrobot@vkrobot：~$<span class="w"> </span>rostopic<span class="w"> </span>list<span class="w"> </span>-v
</span><span id="__span-22-2"><a id="__codelineno-22-2" name="__codelineno-22-2" href="#__codelineno-22-2"></a>
</span><span id="__span-22-3"><a id="__codelineno-22-3" name="__codelineno-22-3" href="#__codelineno-22-3"></a>Published<span class="w"> </span>topics：
</span><span id="__span-22-4"><a id="__codelineno-22-4" name="__codelineno-22-4" href="#__codelineno-22-4"></a><span class="w"> </span>*<span class="w"> </span>/turtle1/color_sensor<span class="w"> </span><span class="o">[</span>turtlesim/Color<span class="o">]</span><span class="w"> </span><span class="m">1</span><span class="w"> </span>publisher
</span><span id="__span-22-5"><a id="__codelineno-22-5" name="__codelineno-22-5" href="#__codelineno-22-5"></a><span class="w"> </span>*<span class="w"> </span>/turtle1/cmd_vel<span class="w"> </span><span class="o">[</span>geometry_msgs/Twist<span class="o">]</span><span class="w"> </span><span class="m">1</span><span class="w"> </span>publisher
</span><span id="__span-22-6"><a id="__codelineno-22-6" name="__codelineno-22-6" href="#__codelineno-22-6"></a><span class="w"> </span>*<span class="w"> </span>/rosout<span class="w"> </span><span class="o">[</span>rosgraph_msgs/Log<span class="o">]</span><span class="w"> </span><span class="m">2</span><span class="w"> </span>publishers
</span><span id="__span-22-7"><a id="__codelineno-22-7" name="__codelineno-22-7" href="#__codelineno-22-7"></a><span class="w"> </span>*<span class="w"> </span>/rosout_agg<span class="w"> </span><span class="o">[</span>rosgraph_msgs/Log<span class="o">]</span><span class="w"> </span><span class="m">1</span><span class="w"> </span>publisher
</span><span id="__span-22-8"><a id="__codelineno-22-8" name="__codelineno-22-8" href="#__codelineno-22-8"></a><span class="w"> </span>*<span class="w"> </span>/turtle1/pose<span class="w"> </span><span class="o">[</span>turtlesim/Pose<span class="o">]</span><span class="w"> </span><span class="m">1</span><span class="w"> </span>publisher
</span><span id="__span-22-9"><a id="__codelineno-22-9" name="__codelineno-22-9" href="#__codelineno-22-9"></a>
</span><span id="__span-22-10"><a id="__codelineno-22-10" name="__codelineno-22-10" href="#__codelineno-22-10"></a>Subscribed<span class="w"> </span>topics：
</span><span id="__span-22-11"><a id="__codelineno-22-11" name="__codelineno-22-11" href="#__codelineno-22-11"></a><span class="w"> </span>*<span class="w"> </span>/turtle1/cmd_vel<span class="w"> </span><span class="o">[</span>geometry_msgs/Twist<span class="o">]</span><span class="w"> </span><span class="m">1</span><span class="w"> </span>subscriber
</span><span id="__span-22-12"><a id="__codelineno-22-12" name="__codelineno-22-12" href="#__codelineno-22-12"></a><span class="w"> </span>*<span class="w"> </span>/rosout<span class="w"> </span><span class="o">[</span>rosgraph_msgs/Log<span class="o">]</span><span class="w"> </span><span class="m">1</span><span class="w"> </span>subscriber
</span></code></pre></div>
<blockquote>
<p>-v 参数可以列出所有发布和订阅的话题及其类型的详细信息</p>
</blockquote>
<h4 id="messages">消息（Messages）</h4>
<p>话题的通信是通过节点间发送ROS消息实现的。为了使发布者（<code>turtle_teleop_key</code>）和订阅者（<code>turtulesim_node</code>）进行通信，发布者和订阅者必须发送和接收相同类型的消息。这意味着话题的类型是由发布在它上面消息的类型决定的。使用<code>rostopic type</code>命令可以查看发布在话题上的消息的类型。</p>
<h5 id="rosmsg">使用 rosmsg</h5>
<p><code>rosmsg</code>可以显示消息类型的具体信息</p>
<p>用法：<code>rosmsg &lt;command&gt; &lt;msg_type&gt;</code></p>
<div class="language-shell highlight"><pre><span></span><code><span id="__span-23-1"><a id="__codelineno-23-1" name="__codelineno-23-1" href="#__codelineno-23-1"></a>vkrobot@vkrobot：~$<span class="w"> </span>rosmsg<span class="w"> </span>show<span class="w"> </span>geometry_msgs/Twist
</span><span id="__span-23-2"><a id="__codelineno-23-2" name="__codelineno-23-2" href="#__codelineno-23-2"></a>geometry_msgs/Vector3<span class="w"> </span>linear
</span><span id="__span-23-3"><a id="__codelineno-23-3" name="__codelineno-23-3" href="#__codelineno-23-3"></a><span class="w">  </span>float64<span class="w"> </span>x
</span><span id="__span-23-4"><a id="__codelineno-23-4" name="__codelineno-23-4" href="#__codelineno-23-4"></a><span class="w">  </span>float64<span class="w"> </span>y
</span><span id="__span-23-5"><a id="__codelineno-23-5" name="__codelineno-23-5" href="#__codelineno-23-5"></a><span class="w">  </span>float64<span class="w"> </span>z
</span><span id="__span-23-6"><a id="__codelineno-23-6" name="__codelineno-23-6" href="#__codelineno-23-6"></a>geometry_msgs/Vector3<span class="w"> </span>angular
</span><span id="__span-23-7"><a id="__codelineno-23-7" name="__codelineno-23-7" href="#__codelineno-23-7"></a><span class="w">  </span>float64<span class="w"> </span>x
</span><span id="__span-23-8"><a id="__codelineno-23-8" name="__codelineno-23-8" href="#__codelineno-23-8"></a><span class="w">  </span>float64<span class="w"> </span>y
</span><span id="__span-23-9"><a id="__codelineno-23-9" name="__codelineno-23-9" href="#__codelineno-23-9"></a><span class="w">  </span>float64<span class="w"> </span>z
</span></code></pre></div>
<blockquote>
<p>可以使用 <code>rostopic type [topic]</code>命令查看指定话题的消息类型，现在我们已经知道了turtlesim节点想要的消息类型，然后就可以发布命令给turtle了</p>
</blockquote>
<h5 id="rostopic_1">使用 rostopic 工具发布消息</h5>
<p><code>rostopic pub</code>可以把数据发布到当前某个正在广播的话题上。</p>
<p>用法：<code>rostopic pub [topic] [msg_type] [args]</code></p>
<div class="language-shell highlight"><pre><span></span><code><span id="__span-24-1"><a id="__codelineno-24-1" name="__codelineno-24-1" href="#__codelineno-24-1"></a>vkrobot@vkrobot：~$<span class="w"> </span>rostopic<span class="w"> </span>pub<span class="w"> </span>-r<span class="w"> </span><span class="m">10</span><span class="w"> </span>/turtle1/cmd_vel<span class="w"> </span>geometry_msgs/Twist<span class="w"> </span><span class="s2">&quot;liner：</span>
</span><span id="__span-24-2"><a id="__codelineno-24-2" name="__codelineno-24-2" href="#__codelineno-24-2"></a><span class="s2">  x： 2.0</span>
</span><span id="__span-24-3"><a id="__codelineno-24-3" name="__codelineno-24-3" href="#__codelineno-24-3"></a><span class="s2">  y： 0.0</span>
</span><span id="__span-24-4"><a id="__codelineno-24-4" name="__codelineno-24-4" href="#__codelineno-24-4"></a><span class="s2">  z： 0.0</span>
</span><span id="__span-24-5"><a id="__codelineno-24-5" name="__codelineno-24-5" href="#__codelineno-24-5"></a><span class="s2">angular：</span>
</span><span id="__span-24-6"><a id="__codelineno-24-6" name="__codelineno-24-6" href="#__codelineno-24-6"></a><span class="s2">  x： 0.0</span>
</span><span id="__span-24-7"><a id="__codelineno-24-7" name="__codelineno-24-7" href="#__codelineno-24-7"></a><span class="s2">  y： 0.0</span>
</span><span id="__span-24-8"><a id="__codelineno-24-8" name="__codelineno-24-8" href="#__codelineno-24-8"></a><span class="s2">  z： 1.8&quot;</span>
</span></code></pre></div>
<blockquote>
<p>可以再次使用<code>rqt_graph</code>命令查看当前的计算图</p>
</blockquote>
<h4 id="_2">复习</h4>
<p>本节所涉及的内容：</p>
<ul>
<li>rqt_graph：计算图可视化工具</li>
<li>rostopic = ros + topic：话题管理工具</li>
<li>rosmsg = ros + msg：消息管理工具</li>
</ul>
<h3 id="233">2.3.3 服务通信</h3>
<p>服务（Services）是节点之间通讯的另一种方式。服务允许节点发送一个请求（request）并获得一个响应（response）。</p>
<figure>
<p><img alt="img" src="../assets/%E6%9C%8D%E5%8A%A1%E9%80%9A%E4%BF%A1.png" width="700" /></p>
</figure>
<h4 id="rosservice">使用 rosservice</h4>
<p>rosservice可以很容易地通过服务附加到ROS客户端/服务器框架上。rosservice有许多可用于服务的命令</p>
<p><strong>用法：</strong></p>
<ul>
<li><code>rosservice list</code>：输出活跃服务的信息</li>
<li><code>rosservice type</code>：输出服务的类型</li>
<li>
<p><code>rosservice call</code>：用给定的参数调用服务</p>
</li>
<li>
<p>...</p>
</li>
<li>
<p><code>rosservice list</code></p>
</li>
</ul>
<p>使用list命令显示turtlesim节点提供的服务</p>
<div class="language-shell highlight"><pre><span></span><code><span id="__span-25-1"><a id="__codelineno-25-1" name="__codelineno-25-1" href="#__codelineno-25-1"></a>vkrobot@vkrobot：~$<span class="w"> </span>rosservice<span class="w"> </span>list
</span><span id="__span-25-2"><a id="__codelineno-25-2" name="__codelineno-25-2" href="#__codelineno-25-2"></a>/clear
</span><span id="__span-25-3"><a id="__codelineno-25-3" name="__codelineno-25-3" href="#__codelineno-25-3"></a>/kill
</span><span id="__span-25-4"><a id="__codelineno-25-4" name="__codelineno-25-4" href="#__codelineno-25-4"></a>/reset
</span><span id="__span-25-5"><a id="__codelineno-25-5" name="__codelineno-25-5" href="#__codelineno-25-5"></a>/rosout/get_loggers
</span><span id="__span-25-6"><a id="__codelineno-25-6" name="__codelineno-25-6" href="#__codelineno-25-6"></a>/rosout/set_logger_level
</span><span id="__span-25-7"><a id="__codelineno-25-7" name="__codelineno-25-7" href="#__codelineno-25-7"></a>/spawn
</span><span id="__span-25-8"><a id="__codelineno-25-8" name="__codelineno-25-8" href="#__codelineno-25-8"></a>/teleop_turtle/get_loggers
</span><span id="__span-25-9"><a id="__codelineno-25-9" name="__codelineno-25-9" href="#__codelineno-25-9"></a>/teleop_turtle/set_logger_level
</span><span id="__span-25-10"><a id="__codelineno-25-10" name="__codelineno-25-10" href="#__codelineno-25-10"></a>/turtle1/set_pen
</span><span id="__span-25-11"><a id="__codelineno-25-11" name="__codelineno-25-11" href="#__codelineno-25-11"></a>/turtle1/teleport_absolute
</span><span id="__span-25-12"><a id="__codelineno-25-12" name="__codelineno-25-12" href="#__codelineno-25-12"></a>/turtle1/teleport_relative
</span><span id="__span-25-13"><a id="__codelineno-25-13" name="__codelineno-25-13" href="#__codelineno-25-13"></a>/turtlesim/get_loggers
</span><span id="__span-25-14"><a id="__codelineno-25-14" name="__codelineno-25-14" href="#__codelineno-25-14"></a>/turtlesim/set_logger_level
</span></code></pre></div>
<ol>
<li><code>rosservice type</code></li>
</ol>
<p><strong>用法：</strong><code>rosservice type [service]</code></p>
<p>来看看clear服务的类型：</p>
<div class="language-shell highlight"><pre><span></span><code><span id="__span-26-1"><a id="__codelineno-26-1" name="__codelineno-26-1" href="#__codelineno-26-1"></a>vkrobot@vkrobot：~$<span class="w"> </span>rosservice<span class="w"> </span><span class="nb">type</span><span class="w"> </span>/clear
</span><span id="__span-26-2"><a id="__codelineno-26-2" name="__codelineno-26-2" href="#__codelineno-26-2"></a>std_srvs/Empty
</span></code></pre></div>
<blockquote>
<p>服务的类型为Empty（空），这表明调用这个服务时不需要参数</p>
</blockquote>
<ol>
<li><code>rosservice call</code></li>
</ol>
<p><strong>用法：</strong><code>rosservice call [service] [args]</code></p>
<div class="language-shell highlight"><pre><span></span><code><span id="__span-27-1"><a id="__codelineno-27-1" name="__codelineno-27-1" href="#__codelineno-27-1"></a>vkrobot@vkrobot：~$<span class="w"> </span>rosservice<span class="w"> </span>call<span class="w"> </span>/clear
</span></code></pre></div>
<figure>
<p><img alt="ROS/Tutorials/UnderstandingServicesParams/turtlesim.png" src="http://wiki.ros.org/ROS/Tutorials/UnderstandingServicesParams?action=AttachFile&amp;do=get&amp;target=turtlesim.png" /></p>
</figure>
<p>再让我们看看服务具有参数的情况。查看spawn（产卵）服务的信息：</p>
<div class="language-shell highlight"><pre><span></span><code><span id="__span-28-1"><a id="__codelineno-28-1" name="__codelineno-28-1" href="#__codelineno-28-1"></a>vkrobot@vkrobot：~$<span class="w"> </span>rosservice<span class="w"> </span><span class="nb">type</span><span class="w"> </span>/spawn<span class="w"> </span><span class="p">|</span><span class="w"> </span>rossrv<span class="w"> </span>show
</span><span id="__span-28-2"><a id="__codelineno-28-2" name="__codelineno-28-2" href="#__codelineno-28-2"></a>float32<span class="w"> </span>x
</span><span id="__span-28-3"><a id="__codelineno-28-3" name="__codelineno-28-3" href="#__codelineno-28-3"></a>float32<span class="w"> </span>y
</span><span id="__span-28-4"><a id="__codelineno-28-4" name="__codelineno-28-4" href="#__codelineno-28-4"></a>float32<span class="w"> </span>theta
</span><span id="__span-28-5"><a id="__codelineno-28-5" name="__codelineno-28-5" href="#__codelineno-28-5"></a>string<span class="w"> </span>name
</span><span id="__span-28-6"><a id="__codelineno-28-6" name="__codelineno-28-6" href="#__codelineno-28-6"></a>---
</span><span id="__span-28-7"><a id="__codelineno-28-7" name="__codelineno-28-7" href="#__codelineno-28-7"></a>string<span class="w"> </span>name
</span></code></pre></div>
<blockquote>
<p>这个服务能让我们可以在给定的位置和角度生成一只新的乌龟。</p>
</blockquote>
<div class="language-shell highlight"><pre><span></span><code><span id="__span-29-1"><a id="__codelineno-29-1" name="__codelineno-29-1" href="#__codelineno-29-1"></a>vkrobot@vkrobot：~$<span class="w"> </span>rosservice<span class="w"> </span>call<span class="w"> </span>/spawn<span class="w"> </span><span class="s2">&quot;x： 2.0</span>
</span><span id="__span-29-2"><a id="__codelineno-29-2" name="__codelineno-29-2" href="#__codelineno-29-2"></a><span class="s2">y： 2.0</span>
</span><span id="__span-29-3"><a id="__codelineno-29-3" name="__codelineno-29-3" href="#__codelineno-29-3"></a><span class="s2">theta： 0.2</span>
</span><span id="__span-29-4"><a id="__codelineno-29-4" name="__codelineno-29-4" href="#__codelineno-29-4"></a><span class="s2">name： &#39;&#39;&quot;</span>
</span></code></pre></div>
<figure>
<p><img alt="ROS/Tutorials/UnderstandingServicesParams/turtle(service).png" src="http://wiki.ros.org/ROS/Tutorials/UnderstandingServicesParams?action=AttachFile&amp;do=get&amp;target=turtle%28service%29.png" /></p>
</figure>
<h4 id="_3">复习</h4>
<p>本节所涉及的内容：</p>
<ul>
<li>rosservice = ros + service：服务管理工具</li>
<li>rossrv = ros + srv：服务数据管理工具</li>
</ul>
<h3 id="234">2.3.4 参数服务器</h3>
<figure>
<p><img alt="img" src="../assets/%E5%8F%82%E6%95%B0%E6%9C%8D%E5%8A%A1%E5%99%A8.png" width="700" /></p>
</figure>
<h4 id="rosparam">使用 rosparam</h4>
<p><code>rosparam</code>能让我们在ROS参数服务器（Parameter Server）上存储和操作数据。参数服务器能够存储整型（integer）、浮点（float）、布尔（boolean）、字典（dictionaries）和列表（list）等数据类型。</p>
<p><strong>用法：</strong></p>
<ul>
<li><code>rosparam set</code>：设置参数</li>
<li><code>rosparam get</code>：获取参数</li>
<li><code>rosparam load</code>：从文件中加载参数</li>
<li><code>rosparam dump</code>：向文件中转储参数</li>
<li><code>rosparam delete</code>：删除参数</li>
<li>
<p><code>rosparam list</code>：列出参数名</p>
</li>
<li>
<p><code>rosparam list</code></p>
</li>
</ul>
<div class="language-shell highlight"><pre><span></span><code><span id="__span-30-1"><a id="__codelineno-30-1" name="__codelineno-30-1" href="#__codelineno-30-1"></a>vkrobot@vkrobot：~$<span class="w"> </span>rosparam<span class="w"> </span>list
</span><span id="__span-30-2"><a id="__codelineno-30-2" name="__codelineno-30-2" href="#__codelineno-30-2"></a>/rosdistro
</span><span id="__span-30-3"><a id="__codelineno-30-3" name="__codelineno-30-3" href="#__codelineno-30-3"></a>/roslaunch/uris/host_nxt__43407
</span><span id="__span-30-4"><a id="__codelineno-30-4" name="__codelineno-30-4" href="#__codelineno-30-4"></a>/rosversion
</span><span id="__span-30-5"><a id="__codelineno-30-5" name="__codelineno-30-5" href="#__codelineno-30-5"></a>/run_id
</span><span id="__span-30-6"><a id="__codelineno-30-6" name="__codelineno-30-6" href="#__codelineno-30-6"></a>/turtlesim/background_b
</span><span id="__span-30-7"><a id="__codelineno-30-7" name="__codelineno-30-7" href="#__codelineno-30-7"></a>/turtlesim/background_g
</span><span id="__span-30-8"><a id="__codelineno-30-8" name="__codelineno-30-8" href="#__codelineno-30-8"></a>/turtlesim/background_r
</span></code></pre></div>
<ol>
<li><code>rosparam set</code> &amp; <code>rosparam get</code></li>
</ol>
<p><strong>用法：</strong><code>rosparam set [param_name]</code></p>
<div class="language-text highlight"><pre><span></span><code>    `rosparam get [param_name]`
</code></pre></div>
<div class="language-shell highlight"><pre><span></span><code><span id="__span-31-1"><a id="__codelineno-31-1" name="__codelineno-31-1" href="#__codelineno-31-1"></a>vkrobot@vkrobot：~$<span class="w"> </span>rosparam<span class="w"> </span>get<span class="w"> </span>/turtlesim/background_r
</span><span id="__span-31-2"><a id="__codelineno-31-2" name="__codelineno-31-2" href="#__codelineno-31-2"></a><span class="m">69</span>
</span><span id="__span-31-3"><a id="__codelineno-31-3" name="__codelineno-31-3" href="#__codelineno-31-3"></a>vkrobot@vkrobot：~$<span class="w"> </span>rosparam<span class="w"> </span><span class="nb">set</span><span class="w"> </span>/turtlesim/background_r<span class="w"> </span><span class="m">150</span>
</span></code></pre></div>
<blockquote>
<p>这里虽然修改了参数的值，但是海龟窗口的背景颜色并没有变化，我们还需要调用clear服务使参数修改能生效</p>
</blockquote>
<div class="language-shell highlight"><pre><span></span><code><span id="__span-32-1"><a id="__codelineno-32-1" name="__codelineno-32-1" href="#__codelineno-32-1"></a>vkrobot@vkrobot：~$<span class="w"> </span>rosservice<span class="w"> </span>call<span class="w"> </span>/clear
</span></code></pre></div>
<figure>
<p><img alt="ROS/Tutorials/UnderstandingServicesParams/turtle(param).png" src="http://wiki.ros.org/ROS/Tutorials/UnderstandingServicesParams?action=AttachFile&amp;do=get&amp;target=turtle%28param%29.png" /></p>
</figure>
<p>也可以用<code>rosparam get /</code>来获取参数服务器中所有的参数内容：</p>
<div class="language-shell highlight"><pre><span></span><code><span id="__span-33-1"><a id="__codelineno-33-1" name="__codelineno-33-1" href="#__codelineno-33-1"></a>vkrobot@vkrobot：~$<span class="w"> </span>rosparam<span class="w"> </span>get<span class="w"> </span>/
</span><span id="__span-33-2"><a id="__codelineno-33-2" name="__codelineno-33-2" href="#__codelineno-33-2"></a>rosdistro：<span class="w"> </span><span class="s1">&#39;melodic</span>
</span><span id="__span-33-3"><a id="__codelineno-33-3" name="__codelineno-33-3" href="#__codelineno-33-3"></a>
</span><span id="__span-33-4"><a id="__codelineno-33-4" name="__codelineno-33-4" href="#__codelineno-33-4"></a><span class="s1">  &#39;</span>
</span><span id="__span-33-5"><a id="__codelineno-33-5" name="__codelineno-33-5" href="#__codelineno-33-5"></a>roslaunch：
</span><span id="__span-33-6"><a id="__codelineno-33-6" name="__codelineno-33-6" href="#__codelineno-33-6"></a><span class="w">  </span>uris：<span class="o">(</span>host_localhost__46785：<span class="w"> </span><span class="s1">&#39;http://localhost：46785/&#39;</span><span class="o">)</span>
</span><span id="__span-33-7"><a id="__codelineno-33-7" name="__codelineno-33-7" href="#__codelineno-33-7"></a>rosversion：<span class="w"> </span><span class="s1">&#39;1.14.3</span>
</span><span id="__span-33-8"><a id="__codelineno-33-8" name="__codelineno-33-8" href="#__codelineno-33-8"></a>
</span><span id="__span-33-9"><a id="__codelineno-33-9" name="__codelineno-33-9" href="#__codelineno-33-9"></a><span class="s1">  &#39;</span>
</span><span id="__span-33-10"><a id="__codelineno-33-10" name="__codelineno-33-10" href="#__codelineno-33-10"></a>run_id：<span class="w"> </span>7ef687d8-9ab7-11ea-b692-fcaa1494dbf9
</span><span id="__span-33-11"><a id="__codelineno-33-11" name="__codelineno-33-11" href="#__codelineno-33-11"></a>turtlesim：<span class="o">(</span>background_b：<span class="w"> </span><span class="m">255</span>，background_g：<span class="w"> </span><span class="m">86</span>，background_r：<span class="w"> </span><span class="m">69</span><span class="o">)</span>
</span></code></pre></div>
<ol>
<li><code>rosparam dump</code> &amp; <code>rosparam load</code></li>
</ol>
<p><strong>用法：</strong><code>rosparam dump [file_name] [namespace]</code></p>
<p>​            <code>rosparam load [file_name] [namespace]</code></p>
<div class="language-shell highlight"><pre><span></span><code><span id="__span-34-1"><a id="__codelineno-34-1" name="__codelineno-34-1" href="#__codelineno-34-1"></a>vkrobot@vkrobot：~$<span class="w"> </span>rosparam<span class="w"> </span>dump<span class="w"> </span>params.yaml
</span></code></pre></div>
<blockquote>
<p>重启<code>roscore</code>与<code>turtlesim</code>后，可以重新加载背景颜色参数</p>
</blockquote>
<div class="language-shell highlight"><pre><span></span><code><span id="__span-35-1"><a id="__codelineno-35-1" name="__codelineno-35-1" href="#__codelineno-35-1"></a>vkrobot@vkrobot：~$<span class="w"> </span>roscore
</span><span id="__span-35-2"><a id="__codelineno-35-2" name="__codelineno-35-2" href="#__codelineno-35-2"></a>vkrobot@vkrobot：~$<span class="w"> </span>rosrun<span class="w"> </span>turtlesim<span class="w"> </span>turtlesim_node
</span><span id="__span-35-3"><a id="__codelineno-35-3" name="__codelineno-35-3" href="#__codelineno-35-3"></a>vkrobot@vkrobot：~$<span class="w"> </span>rosparam<span class="w"> </span>load<span class="w"> </span>param.yaml
</span><span id="__span-35-4"><a id="__codelineno-35-4" name="__codelineno-35-4" href="#__codelineno-35-4"></a>vkrobot@vkrobot：~$<span class="w"> </span>rosservice<span class="w"> </span>call<span class="w"> </span>/clear
</span></code></pre></div>
<h4 id="_4">复习</h4>
<p>本节所涉及的内容：</p>
<ul>
<li>rosparam = ros + param：参数管理工具</li>
</ul>
<h3 id="235">2.3.5 文件系统</h3>
<figure>
<p><img alt="img" src="../assets/%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F.png" width="700" /></p>
</figure>
<p>程序代码散落在许多ROS包中。使用Linux内置命令行工具（如<code>ls</code>和<code>cd</code>）来进行查找和导航可能非常繁琐，因此ROS提供了专门的命令工具来简化这些操作</p>
<h4 id="rospack">使用 rospack</h4>
<p><code>rospack</code>允许用户获取功能包的有关信息</p>
<p><strong>用法：</strong><code>rospack &lt;command&gt; [option] [package_name]</code></p>
<div class="language-shell highlight"><pre><span></span><code><span id="__span-36-1"><a id="__codelineno-36-1" name="__codelineno-36-1" href="#__codelineno-36-1"></a>vkrobot@vkrobot：~$<span class="w"> </span>rospack<span class="w"> </span>find<span class="w"> </span>rospy
</span><span id="__span-36-2"><a id="__codelineno-36-2" name="__codelineno-36-2" href="#__codelineno-36-2"></a>/opt/ros/melodic/share/rospy
</span></code></pre></div>
<h4 id="roscd">使用 roscd</h4>
<p><code>roscd</code>允许用户直接切换目录到某个功能包或元功能包中</p>
<p><strong>用法：</strong><code>roscd [locationname[/subdir]]</code></p>
<div class="language-shell highlight"><pre><span></span><code><span id="__span-37-1"><a id="__codelineno-37-1" name="__codelineno-37-1" href="#__codelineno-37-1"></a>vkrobot@vkrobot：~$<span class="w"> </span>roscd<span class="w"> </span>rospy
</span><span id="__span-37-2"><a id="__codelineno-37-2" name="__codelineno-37-2" href="#__codelineno-37-2"></a>vkrobot@vkrobot：/opt/ros/melodic/share/rospy$<span class="w"> </span><span class="nb">pwd</span>
</span><span id="__span-37-3"><a id="__codelineno-37-3" name="__codelineno-37-3" href="#__codelineno-37-3"></a>/opt/ros/melodic/share/rospy
</span></code></pre></div>
<h4 id="rosls">使用 rosls</h4>
<p><code>rosls</code>允许用户直接按功能包的名称执行<code>ls</code>命令（而不必输入绝对路径）</p>
<p><strong>用法：</strong><code>rosls [locationname[/subdir]]</code></p>
<div class="language-shell highlight"><pre><span></span><code><span id="__span-38-1"><a id="__codelineno-38-1" name="__codelineno-38-1" href="#__codelineno-38-1"></a>vkrobot@vkrobot：~$<span class="w"> </span>rosls<span class="w"> </span>rospy
</span><span id="__span-38-2"><a id="__codelineno-38-2" name="__codelineno-38-2" href="#__codelineno-38-2"></a>cmake<span class="w"> </span>package.xml<span class="w"> </span>rosbuild
</span></code></pre></div>
<h4 id="tab">Tab补全</h4>
<p>总是输入完整的软件包名称感觉比较繁琐。在之前的例子中，<code>turtlesim turtlesim_node</code>是个相当长的名称。幸运的是，一些ROS工具支持TAB补全的功能。</p>
<div class="language-shell highlight"><pre><span></span><code><span id="__span-39-1"><a id="__codelineno-39-1" name="__codelineno-39-1" href="#__codelineno-39-1"></a>vkrobot@vkrobot：~$<span class="w"> </span>roscd<span class="w"> </span>turtles<span class="o">&lt;&lt;&lt;</span>按TAB键&gt;&gt;&gt;
</span></code></pre></div>
<blockquote>
<p>当按<strong>TAB</strong>键后，命令行应该会自动补充剩余部分：</p>
</blockquote>
<h4 id="_5">复习</h4>
<p>本节所涉及的内容：</p>
<ul>
<li>rospack = ros + pack(age)：提供与ROS包相关的信息</li>
<li>roscd = ros + cd：将目录更改为ROS包或堆栈</li>
<li>rosls = ros + ls：列出ROS包中的文件</li>
</ul>
<h2 id="24">2.4 工作空间与功能包</h2>
<p>catkin是ROS官方指定的编译系统，一个包要想称为catkin功能包，必须符合以下要求：</p>
<ul>
<li>这个包必须有一个符合catkin规范的package.xml文件</li>
<li>这个<code>package.xml</code>文件提供有关该功能包的元信息</li>
<li>这个包必须有一个catkin版本的CMakeLists.txt文件</li>
<li>如果它是个Catkin元包的话，则需要有一个<code>CMakeList.txt</code>文件的相关样板</li>
<li>每个包必须有自己的目录</li>
<li>这意味着在同一个目录下不能有嵌套的或者多个功能包存在</li>
</ul>
<p>最简单的功能包看起来就像这样：</p>
<div class="language-shell highlight"><pre><span></span><code><span id="__span-40-1"><a id="__codelineno-40-1" name="__codelineno-40-1" href="#__codelineno-40-1"></a>my_package/
</span><span id="__span-40-2"><a id="__codelineno-40-2" name="__codelineno-40-2" href="#__codelineno-40-2"></a><span class="w">  </span>CMakeLists.txt
</span><span id="__span-40-3"><a id="__codelineno-40-3" name="__codelineno-40-3" href="#__codelineno-40-3"></a><span class="w">  </span>package.xml
</span></code></pre></div>
<p>开发catkin功能包的推荐方法是使用catkin工作空间，一个简单的工作空间如下所示：</p>
<div class="language-shell highlight"><pre><span></span><code><span id="__span-41-1"><a id="__codelineno-41-1" name="__codelineno-41-1" href="#__codelineno-41-1"></a>workspace_folder/<span class="w">         </span>--<span class="w"> </span>WORKSPACE
</span><span id="__span-41-2"><a id="__codelineno-41-2" name="__codelineno-41-2" href="#__codelineno-41-2"></a><span class="w">  </span>build/<span class="w">                  </span>--<span class="w"> </span>BUILD<span class="w"> </span>SPACE
</span><span id="__span-41-3"><a id="__codelineno-41-3" name="__codelineno-41-3" href="#__codelineno-41-3"></a><span class="w">  </span>devel/<span class="w">                  </span>--<span class="w"> </span>DEVELOPMENT<span class="w"> </span>SPACE
</span><span id="__span-41-4"><a id="__codelineno-41-4" name="__codelineno-41-4" href="#__codelineno-41-4"></a><span class="w">    </span>setup.bash
</span><span id="__span-41-5"><a id="__codelineno-41-5" name="__codelineno-41-5" href="#__codelineno-41-5"></a><span class="w">    </span>...
</span><span id="__span-41-6"><a id="__codelineno-41-6" name="__codelineno-41-6" href="#__codelineno-41-6"></a><span class="w">  </span>src/<span class="w">                   </span>--<span class="w"> </span>SOURCE<span class="w"> </span>SPACE
</span><span id="__span-41-7"><a id="__codelineno-41-7" name="__codelineno-41-7" href="#__codelineno-41-7"></a><span class="w">    </span>CMakeLists.txt<span class="w">       </span>--<span class="w"> </span><span class="s1">&#39;Toplevel&#39;</span><span class="w"> </span>CMake<span class="w"> </span>file
</span><span id="__span-41-8"><a id="__codelineno-41-8" name="__codelineno-41-8" href="#__codelineno-41-8"></a><span class="w">    </span>package_1/
</span><span id="__span-41-9"><a id="__codelineno-41-9" name="__codelineno-41-9" href="#__codelineno-41-9"></a><span class="w">      </span>CMakeLists.txt<span class="w">     </span>--<span class="w"> </span>CMakeLists.txt<span class="w"> </span>file<span class="w"> </span><span class="k">for</span><span class="w"> </span>package_1
</span><span id="__span-41-10"><a id="__codelineno-41-10" name="__codelineno-41-10" href="#__codelineno-41-10"></a><span class="w">      </span>package.xml<span class="w">        </span>--<span class="w"> </span>Package<span class="w"> </span>manifest<span class="w"> </span><span class="k">for</span><span class="w"> </span>package_1
</span><span id="__span-41-11"><a id="__codelineno-41-11" name="__codelineno-41-11" href="#__codelineno-41-11"></a><span class="w">    </span>...
</span><span id="__span-41-12"><a id="__codelineno-41-12" name="__codelineno-41-12" href="#__codelineno-41-12"></a><span class="w">    </span>package_n/
</span><span id="__span-41-13"><a id="__codelineno-41-13" name="__codelineno-41-13" href="#__codelineno-41-13"></a><span class="w">      </span>CMakeLists.txt<span class="w">     </span>--<span class="w"> </span>CMakeLists.txt<span class="w"> </span>file<span class="w"> </span><span class="k">for</span><span class="w"> </span>package_n
</span><span id="__span-41-14"><a id="__codelineno-41-14" name="__codelineno-41-14" href="#__codelineno-41-14"></a><span class="w">      </span>package.xml<span class="w">        </span>--<span class="w"> </span>Package<span class="w"> </span>manifest<span class="w"> </span><span class="k">for</span><span class="w"> </span>package_n
</span></code></pre></div>
<h3 id="241">2.4.1 创建工作空间</h3>
<p>下面我们开始创建和构建一个catkin工作空间</p>
<div class="language-shell highlight"><pre><span></span><code><span id="__span-42-1"><a id="__codelineno-42-1" name="__codelineno-42-1" href="#__codelineno-42-1"></a>vkrobot@vkrobot：~$<span class="w"> </span>mkdir<span class="w"> </span>-p<span class="w"> </span>~/catkin_ws/src
</span><span id="__span-42-2"><a id="__codelineno-42-2" name="__codelineno-42-2" href="#__codelineno-42-2"></a>vkrobot@vkrobot：~$<span class="w"> </span><span class="nb">cd</span><span class="w"> </span>~/catkin_ws
</span><span id="__span-42-3"><a id="__codelineno-42-3" name="__codelineno-42-3" href="#__codelineno-42-3"></a>vkrobot@vkrobot：~/catkin_ws$<span class="w"> </span>catkin_make<span class="w"> </span><span class="c1">#编译</span>
</span><span id="__span-42-4"><a id="__codelineno-42-4" name="__codelineno-42-4" href="#__codelineno-42-4"></a>vkrobot@vkrobot：~/catkin_ws$<span class="w"> </span><span class="nb">source</span><span class="w"> </span>devel/setup.bash<span class="w"> </span><span class="c1">#设置环境变量</span>
</span><span id="__span-42-5"><a id="__codelineno-42-5" name="__codelineno-42-5" href="#__codelineno-42-5"></a>vkrobot@vkrobot：~/catkin_ws$<span class="w"> </span><span class="nb">echo</span><span class="w"> </span><span class="nv">$ROS_PACKAGE_PATH</span><span class="w">  </span><span class="c1">#检查环境变量</span>
</span><span id="__span-42-6"><a id="__codelineno-42-6" name="__codelineno-42-6" href="#__codelineno-42-6"></a>/home/vkrobot/catkin_ws/src：/opt/ros/melodic/share
</span></code></pre></div>
<h3 id="242">2.4.2 创建功能包</h3>
<p><code>catkin_create_pkg</code>是ROS提供的功能包创建工具</p>
<p><strong>用法：</strong><code>catkin_create_pkg &lt;package_name&gt; [depend1] [depend2]</code></p>
<p>下面我们开始创建一个功能包：</p>
<div class="language-shell highlight"><pre><span></span><code><span id="__span-43-1"><a id="__codelineno-43-1" name="__codelineno-43-1" href="#__codelineno-43-1"></a>vkrobot@vkrobot：~$<span class="w"> </span><span class="nb">cd</span><span class="w"> </span>~/catkin_ws/src
</span><span id="__span-43-2"><a id="__codelineno-43-2" name="__codelineno-43-2" href="#__codelineno-43-2"></a>vkrobot@vkrobot：~/catkin_ws/src$<span class="w"> </span>catkin_create_pkg<span class="w"> </span>vkrobot_tutorials<span class="w"> </span>std_msgs<span class="w"> </span>rospy<span class="w"> </span>roscpp
</span><span id="__span-43-3"><a id="__codelineno-43-3" name="__codelineno-43-3" href="#__codelineno-43-3"></a>vkrobot@vkrobot：~/catkin_ws/src$<span class="w"> </span><span class="nb">cd</span><span class="w"> </span>..
</span><span id="__span-43-4"><a id="__codelineno-43-4" name="__codelineno-43-4" href="#__codelineno-43-4"></a>vkrobot@vkrobot：~/catkin_ws$<span class="w"> </span>catkin_make<span class="w">  </span><span class="c1">#重新编译</span>
</span><span id="__span-43-5"><a id="__codelineno-43-5" name="__codelineno-43-5" href="#__codelineno-43-5"></a>vkrobot@vkrobot：~/catkin_ws$<span class="w"> </span><span class="nb">source</span><span class="w"> </span>devel/setup.bash<span class="w"> </span><span class="c1">#设置环境变量</span>
</span><span id="__span-43-6"><a id="__codelineno-43-6" name="__codelineno-43-6" href="#__codelineno-43-6"></a>vkrobot@vkrobot：~/catkin_ws$<span class="w"> </span><span class="nb">echo</span><span class="w"> </span><span class="nv">$ROS_PACKAGE_PATH</span><span class="w">  </span><span class="c1">#检查环境变量</span>
</span><span id="__span-43-7"><a id="__codelineno-43-7" name="__codelineno-43-7" href="#__codelineno-43-7"></a>/home/vkrobot/catkin_ws/src：/opt/ros/melodic/share
</span></code></pre></div>
<blockquote>
<p>使用以下命令添加工作空间的环境变量以保正每次打开新终端都能自动设置环境变量</p>
<p><code>echo "source /home/&lt;用户名&gt;/&lt;工作空间名称&gt;/devel/setup.bash" &gt;&gt; ~/.bashrc</code></p>
</blockquote>
<h3 id="243-vscode">2.4.3 VScode集成开发环境搭建</h3>
<p><strong>1.下载</strong></p>
<p>vscode 下载：<a href="https://code.visualstudio.com/download">Visual Studio Code Download</a></p>
<figure>
<p><img alt="image-20230516180239078" src="../assets/image-20230516180239078.png" /></p>
</figure>
<p><strong>2.安装</strong></p>
<p><code>sudo dpkg -i xxx.deb</code></p>
<p><strong>3.安装插件</strong></p>
<figure>
<p><img alt="image-20230516180124455" src="../assets/image-20230516180124455.png" /></p>
</figure>
<h2 id="25">2.5 话题通信</h2>
<figure>
<p><img alt="image-20230425152553540" src="../assets/image-20230425152553540.png" width="600" /></p>
</figure>
<h3 id="251">2.5.1 发布者节点编程实现</h3>
<div class="language-shell highlight"><pre><span></span><code><span id="__span-44-1"><a id="__codelineno-44-1" name="__codelineno-44-1" href="#__codelineno-44-1"></a>vkrobot@vkrobot：~$<span class="w"> </span>roscd<span class="w"> </span>vkrobot_tutorials
</span><span id="__span-44-2"><a id="__codelineno-44-2" name="__codelineno-44-2" href="#__codelineno-44-2"></a>vkrobot@vkrobot：~/catkin_ws/src/vkrobot_tutorials$<span class="w"> </span>mkdir<span class="w"> </span>scripts
</span><span id="__span-44-3"><a id="__codelineno-44-3" name="__codelineno-44-3" href="#__codelineno-44-3"></a>vkrobot@vkrobot：~/catkin_ws/src/vkrobot_tutorials$<span class="w"> </span><span class="nb">cd</span><span class="w"> </span>scripts
</span><span id="__span-44-4"><a id="__codelineno-44-4" name="__codelineno-44-4" href="#__codelineno-44-4"></a>vkrobot@vkrobot：~/catkin_ws/src/vkrobot_tutorials/scripts$<span class="w"> </span>touch<span class="w"> </span>talker.py
</span><span id="__span-44-5"><a id="__codelineno-44-5" name="__codelineno-44-5" href="#__codelineno-44-5"></a>vkrobot@vkrobot：~/catkin_ws/src/vkrobot_tutorials/scripts$<span class="w"> </span>chmod<span class="w"> </span>+x<span class="w"> </span>talker.py<span class="w">  </span><span class="c1">#添加可执行权限</span>
</span></code></pre></div>
<p>编辑talker.py文件，添加以下内容：</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-45-1"><a id="__codelineno-45-1" name="__codelineno-45-1" href="#__codelineno-45-1"></a><span class="ch">#!/usr/bin/env python3</span>
</span><span id="__span-45-2"><a id="__codelineno-45-2" name="__codelineno-45-2" href="#__codelineno-45-2"></a><span class="c1">#每个Python ROS节点的最开头都有这个声明</span>
</span><span id="__span-45-3"><a id="__codelineno-45-3" name="__codelineno-45-3" href="#__codelineno-45-3"></a>
</span><span id="__span-45-4"><a id="__codelineno-45-4" name="__codelineno-45-4" href="#__codelineno-45-4"></a><span class="kn">import</span> <span class="nn">rospy</span>  <span class="c1">#如果要使用python编写ROS节点，都需要导入rospy</span>
</span><span id="__span-45-5"><a id="__codelineno-45-5" name="__codelineno-45-5" href="#__codelineno-45-5"></a><span class="kn">from</span> <span class="nn">std_msgs.msg</span> <span class="kn">import</span> <span class="n">String</span>  <span class="c1">#导入std_msgs/String消息类型来发布字符串消息</span>
</span><span id="__span-45-6"><a id="__codelineno-45-6" name="__codelineno-45-6" href="#__codelineno-45-6"></a>
</span><span id="__span-45-7"><a id="__codelineno-45-7" name="__codelineno-45-7" href="#__codelineno-45-7"></a><span class="k">def</span> <span class="nf">talker</span><span class="p">()</span><span class="err">：</span>
</span><span id="__span-45-8"><a id="__codelineno-45-8" name="__codelineno-45-8" href="#__codelineno-45-8"></a>    <span class="c1">#向ROS Master注册节点信息，参数包括（话题名称，消息类型，队列长度）</span>
</span><span id="__span-45-9"><a id="__codelineno-45-9" name="__codelineno-45-9" href="#__codelineno-45-9"></a>    <span class="n">pub</span> <span class="o">=</span> <span class="n">rospy</span><span class="o">.</span><span class="n">Publisher</span><span class="p">(</span><span class="s1">&#39;chatter&#39;</span><span class="p">,</span> <span class="n">String</span><span class="p">,</span> <span class="n">queue_size</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
</span><span id="__span-45-10"><a id="__codelineno-45-10" name="__codelineno-45-10" href="#__codelineno-45-10"></a>    <span class="c1">#初始化ROS节点，第一个参数为节点名称，第二个参数会在名称末尾添加随机数，以确保节点具有唯一的名称</span>
</span><span id="__span-45-11"><a id="__codelineno-45-11" name="__codelineno-45-11" href="#__codelineno-45-11"></a>    <span class="n">rospy</span><span class="o">.</span><span class="n">init_node</span><span class="p">(</span><span class="s1">&#39;talker&#39;</span><span class="p">,</span> <span class="n">anonymous</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="__span-45-12"><a id="__codelineno-45-12" name="__codelineno-45-12" href="#__codelineno-45-12"></a>    <span class="c1">#创建一个Rate对象，传入参数10表示希望的循环速率为10Hz</span>
</span><span id="__span-45-13"><a id="__codelineno-45-13" name="__codelineno-45-13" href="#__codelineno-45-13"></a>    <span class="n">rate</span> <span class="o">=</span> <span class="n">rospy</span><span class="o">.</span><span class="n">Rate</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
</span><span id="__span-45-14"><a id="__codelineno-45-14" name="__codelineno-45-14" href="#__codelineno-45-14"></a>    <span class="k">while</span> <span class="ow">not</span> <span class="n">rospy</span><span class="o">.</span><span class="n">is_shutdown</span><span class="p">()</span><span class="err">：</span>
</span><span id="__span-45-15"><a id="__codelineno-45-15" name="__codelineno-45-15" href="#__codelineno-45-15"></a>        <span class="c1">#封装需要发布的消息数据</span>
</span><span id="__span-45-16"><a id="__codelineno-45-16" name="__codelineno-45-16" href="#__codelineno-45-16"></a>        <span class="n">hello_str</span> <span class="o">=</span> <span class="n">String</span><span class="p">()</span>
</span><span id="__span-45-17"><a id="__codelineno-45-17" name="__codelineno-45-17" href="#__codelineno-45-17"></a>        <span class="n">hello_str</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="s2">&quot;hello world </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">rospy</span><span class="o">.</span><span class="n">get_time</span><span class="p">()</span>
</span><span id="__span-45-18"><a id="__codelineno-45-18" name="__codelineno-45-18" href="#__codelineno-45-18"></a>        <span class="c1">#发布封装好的消息数据</span>
</span><span id="__span-45-19"><a id="__codelineno-45-19" name="__codelineno-45-19" href="#__codelineno-45-19"></a>        <span class="n">pub</span><span class="o">.</span><span class="n">publish</span><span class="p">(</span><span class="n">hello_str</span><span class="p">)</span>
</span><span id="__span-45-20"><a id="__codelineno-45-20" name="__codelineno-45-20" href="#__codelineno-45-20"></a>        <span class="c1">#在循环中使用rate.sleep()，它可以用刚刚好的睡眠时间来维持期望的循环速率</span>
</span><span id="__span-45-21"><a id="__codelineno-45-21" name="__codelineno-45-21" href="#__codelineno-45-21"></a>        <span class="n">rate</span><span class="o">.</span><span class="n">sleep</span><span class="p">()</span>
</span><span id="__span-45-22"><a id="__codelineno-45-22" name="__codelineno-45-22" href="#__codelineno-45-22"></a>
</span><span id="__span-45-23"><a id="__codelineno-45-23" name="__codelineno-45-23" href="#__codelineno-45-23"></a><span class="k">if</span> <span class="vm">__name__</span>  <span class="s1">&#39;__main__&#39;</span><span class="err">：</span>
</span><span id="__span-45-24"><a id="__codelineno-45-24" name="__codelineno-45-24" href="#__codelineno-45-24"></a>    <span class="k">try</span><span class="err">：</span>
</span><span id="__span-45-25"><a id="__codelineno-45-25" name="__codelineno-45-25" href="#__codelineno-45-25"></a>        <span class="n">talker</span><span class="p">()</span>
</span><span id="__span-45-26"><a id="__codelineno-45-26" name="__codelineno-45-26" href="#__codelineno-45-26"></a>    <span class="k">except</span> <span class="n">rospy</span><span class="o">.</span><span class="n">ROSInterruptException</span><span class="err">：</span>  <span class="c1">#捕获程序异常</span>
</span><span id="__span-45-27"><a id="__codelineno-45-27" name="__codelineno-45-27" href="#__codelineno-45-27"></a>        <span class="k">pass</span>
</span></code></pre></div>
<p>运行talker节点：</p>
<div class="language-shell highlight"><pre><span></span><code><span id="__span-46-1"><a id="__codelineno-46-1" name="__codelineno-46-1" href="#__codelineno-46-1"></a>vkrobot@vkrobot：~$<span class="w"> </span>roscore<span class="w"> </span><span class="c1">#先启动ROS Master</span>
</span><span id="__span-46-2"><a id="__codelineno-46-2" name="__codelineno-46-2" href="#__codelineno-46-2"></a>vkrobot@vkrobot：~$<span class="w"> </span>rosrun<span class="w"> </span>vkrobot_tutorials<span class="w"> </span>talker.py
</span></code></pre></div>
<p>运行成功后，打开一个新终端订阅chatter话题接收消息：</p>
<div class="language-shell highlight"><pre><span></span><code><span id="__span-47-1"><a id="__codelineno-47-1" name="__codelineno-47-1" href="#__codelineno-47-1"></a>vkrobot@vkrobot：~$<span class="w"> </span>rostopic<span class="w"> </span><span class="nb">echo</span><span class="w"> </span>/chatter
</span><span id="__span-47-2"><a id="__codelineno-47-2" name="__codelineno-47-2" href="#__codelineno-47-2"></a>data：<span class="w"> </span><span class="s2">&quot;hello world 1682410011.24&quot;</span>
</span><span id="__span-47-3"><a id="__codelineno-47-3" name="__codelineno-47-3" href="#__codelineno-47-3"></a>---
</span><span id="__span-47-4"><a id="__codelineno-47-4" name="__codelineno-47-4" href="#__codelineno-47-4"></a>data：<span class="w"> </span><span class="s2">&quot;hello world 1682410011.34&quot;</span>
</span><span id="__span-47-5"><a id="__codelineno-47-5" name="__codelineno-47-5" href="#__codelineno-47-5"></a>......
</span></code></pre></div>
<h3 id="252">2.5.2 订阅者节点编程实现</h3>
<div class="language-shell highlight"><pre><span></span><code><span id="__span-48-1"><a id="__codelineno-48-1" name="__codelineno-48-1" href="#__codelineno-48-1"></a>vkrobot@vkrobot：~$<span class="w"> </span>roscd<span class="w"> </span>vkrobot_tutorials/scripts
</span><span id="__span-48-2"><a id="__codelineno-48-2" name="__codelineno-48-2" href="#__codelineno-48-2"></a>vkrobot@vkrobot：~/catkin_ws/src/vkrobot_tutorials/scripts$<span class="w"> </span>touch<span class="w"> </span>listener.py
</span><span id="__span-48-3"><a id="__codelineno-48-3" name="__codelineno-48-3" href="#__codelineno-48-3"></a>vkrobot@vkrobot：~/catkin_ws/src/vkrobot_tutorials/scripts$<span class="w"> </span>chmod<span class="w"> </span>+x<span class="w"> </span>listener.py<span class="w">  </span><span class="c1">#添加可执行权限</span>
</span></code></pre></div>
<p>编辑listener.py文件，添加以下内容：</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-49-1"><a id="__codelineno-49-1" name="__codelineno-49-1" href="#__codelineno-49-1"></a><span class="ch">#!/usr/bin/env python3</span>
</span><span id="__span-49-2"><a id="__codelineno-49-2" name="__codelineno-49-2" href="#__codelineno-49-2"></a><span class="c1">#每个Python ROS节点的最开头都有这个声明</span>
</span><span id="__span-49-3"><a id="__codelineno-49-3" name="__codelineno-49-3" href="#__codelineno-49-3"></a>
</span><span id="__span-49-4"><a id="__codelineno-49-4" name="__codelineno-49-4" href="#__codelineno-49-4"></a><span class="kn">import</span> <span class="nn">rospy</span>  <span class="c1">#如果要使用python编写ROS节点，都需要导入rospy</span>
</span><span id="__span-49-5"><a id="__codelineno-49-5" name="__codelineno-49-5" href="#__codelineno-49-5"></a><span class="kn">from</span> <span class="nn">std_msgs.msg</span> <span class="kn">import</span> <span class="n">String</span>  <span class="c1">#导入std_msgs/String消息类型定义需要接收的消息类型</span>
</span><span id="__span-49-6"><a id="__codelineno-49-6" name="__codelineno-49-6" href="#__codelineno-49-6"></a>
</span><span id="__span-49-7"><a id="__codelineno-49-7" name="__codelineno-49-7" href="#__codelineno-49-7"></a><span class="c1">#回调函数</span>
</span><span id="__span-49-8"><a id="__codelineno-49-8" name="__codelineno-49-8" href="#__codelineno-49-8"></a><span class="k">def</span> <span class="nf">callback</span><span class="p">(</span><span class="n">data</span><span class="p">)</span><span class="err">：</span>
</span><span id="__span-49-9"><a id="__codelineno-49-9" name="__codelineno-49-9" href="#__codelineno-49-9"></a>    <span class="c1">#向终端输出日志信息</span>
</span><span id="__span-49-10"><a id="__codelineno-49-10" name="__codelineno-49-10" href="#__codelineno-49-10"></a>    <span class="n">rospy</span><span class="o">.</span><span class="n">loginfo</span><span class="p">(</span><span class="n">rospy</span><span class="o">.</span><span class="n">get_caller_id</span><span class="p">()</span> <span class="o">+</span> <span class="s2">&quot; I heard </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
</span><span id="__span-49-11"><a id="__codelineno-49-11" name="__codelineno-49-11" href="#__codelineno-49-11"></a>
</span><span id="__span-49-12"><a id="__codelineno-49-12" name="__codelineno-49-12" href="#__codelineno-49-12"></a><span class="k">def</span> <span class="nf">listener</span><span class="p">()</span><span class="err">：</span>
</span><span id="__span-49-13"><a id="__codelineno-49-13" name="__codelineno-49-13" href="#__codelineno-49-13"></a>    <span class="c1">#初始化ROS节点，第一个参数为节点名称，第二个参数会在名称末尾添加随机数，以确保节点具有唯一的名称</span>
</span><span id="__span-49-14"><a id="__codelineno-49-14" name="__codelineno-49-14" href="#__codelineno-49-14"></a>    <span class="n">rospy</span><span class="o">.</span><span class="n">init_node</span><span class="p">(</span><span class="s1">&#39;listener&#39;</span><span class="p">,</span> <span class="n">anonymous</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="__span-49-15"><a id="__codelineno-49-15" name="__codelineno-49-15" href="#__codelineno-49-15"></a>    <span class="c1">#向ROS Master注册节点信息，参数包括（话题名称，消息类型，回调函数）</span>
</span><span id="__span-49-16"><a id="__codelineno-49-16" name="__codelineno-49-16" href="#__codelineno-49-16"></a>    <span class="n">rospy</span><span class="o">.</span><span class="n">Subscriber</span><span class="p">(</span><span class="s2">&quot;chatter&quot;</span><span class="p">,</span> <span class="n">String</span><span class="p">,</span> <span class="n">callback</span><span class="p">)</span>
</span><span id="__span-49-17"><a id="__codelineno-49-17" name="__codelineno-49-17" href="#__codelineno-49-17"></a>    <span class="c1">#阻塞循环，等待消息传递，一旦接收到消息则进入回调函数进行处理</span>
</span><span id="__span-49-18"><a id="__codelineno-49-18" name="__codelineno-49-18" href="#__codelineno-49-18"></a>    <span class="n">rospy</span><span class="o">.</span><span class="n">spin</span><span class="p">()</span>
</span><span id="__span-49-19"><a id="__codelineno-49-19" name="__codelineno-49-19" href="#__codelineno-49-19"></a>
</span><span id="__span-49-20"><a id="__codelineno-49-20" name="__codelineno-49-20" href="#__codelineno-49-20"></a><span class="k">if</span> <span class="vm">__name__</span>  <span class="s1">&#39;__main__&#39;</span><span class="err">：</span>
</span><span id="__span-49-21"><a id="__codelineno-49-21" name="__codelineno-49-21" href="#__codelineno-49-21"></a>    <span class="n">listener</span><span class="p">()</span>
</span></code></pre></div>
<p>运行listener节点：</p>
<div class="language-shell highlight"><pre><span></span><code><span id="__span-50-1"><a id="__codelineno-50-1" name="__codelineno-50-1" href="#__codelineno-50-1"></a>vkrobot@vkrobot：~$<span class="w"> </span>rosrun<span class="w"> </span>vkrobot_tutorials<span class="w"> </span>listener.py
</span><span id="__span-50-2"><a id="__codelineno-50-2" name="__codelineno-50-2" href="#__codelineno-50-2"></a><span class="o">[</span>INFO<span class="o">]</span><span class="w"> </span><span class="o">[</span><span class="m">1314931969</span>.258941<span class="o">]</span><span class="w"> </span>/listener_17657_1314931968795<span class="w"> </span>I<span class="w"> </span>heard<span class="w"> </span>hello<span class="w"> </span>world<span class="w"> </span><span class="m">1314931969</span>.26
</span><span id="__span-50-3"><a id="__codelineno-50-3" name="__codelineno-50-3" href="#__codelineno-50-3"></a><span class="o">[</span>INFO<span class="o">]</span><span class="w"> </span><span class="o">[</span><span class="m">1314931970</span>.262246<span class="o">]</span><span class="w"> </span>/listener_17657_1314931968795<span class="w"> </span>I<span class="w"> </span>heard<span class="w"> </span>hello<span class="w"> </span>world<span class="w"> </span><span class="m">1314931970</span>.26
</span><span id="__span-50-4"><a id="__codelineno-50-4" name="__codelineno-50-4" href="#__codelineno-50-4"></a>......
</span></code></pre></div>
<blockquote>
<p>⚠⚠⚠确保ROS Master与talker节点已启动</p>
</blockquote>
<h3 id="253">2.5.3 自定义消息类型</h3>
<p>ROS本身提供了许多不同消息类型的功能包，如：std_msgs、geometry_msgs、sensor_msgs等，可以满足一般场景的使用，但是在很多情况下用户依然需要针对具体的需求定义特定的消息类型</p>
<ul>
<li>msg（消息）：msg文件就是文本文件，用于描述ROS消息的字段。它们用于为不同编程语言编写的消息生成源代码</li>
</ul>
<div class="language-shell highlight"><pre><span></span><code><span id="__span-51-1"><a id="__codelineno-51-1" name="__codelineno-51-1" href="#__codelineno-51-1"></a>vkrobot@vkrobot：~$<span class="w"> </span>rosmsg<span class="w"> </span>show<span class="w"> </span>std_msgs/String
</span><span id="__span-51-2"><a id="__codelineno-51-2" name="__codelineno-51-2" href="#__codelineno-51-2"></a>string<span class="w"> </span>data
</span></code></pre></div>
<p>msg文件存放在软件包的<code>msg</code>目录下</p>
<p>msg文件就是简单的文本文件，每行都有一个字段类型和字段名称。可以使用的类型为：</p>
<ul>
<li>int8, int16, int32, int64 (以及 uint*)</li>
<li>float32, float64</li>
<li>string</li>
<li>time, duration</li>
<li>其他msg文件</li>
</ul>
<p>下面，我们将在之前创建好的功能包中定义一个新的消息类型：</p>
<div class="language-shell highlight"><pre><span></span><code><span id="__span-52-1"><a id="__codelineno-52-1" name="__codelineno-52-1" href="#__codelineno-52-1"></a>vkrobot@vkrobot：~$<span class="w"> </span>roscd<span class="w"> </span>vkrobot_tutorials
</span><span id="__span-52-2"><a id="__codelineno-52-2" name="__codelineno-52-2" href="#__codelineno-52-2"></a>vkrobot@vkrobot：~/catkin_ws/src/vkrobot_tutorials$<span class="w"> </span>mkdir<span class="w"> </span>msg
</span><span id="__span-52-3"><a id="__codelineno-52-3" name="__codelineno-52-3" href="#__codelineno-52-3"></a>vkrobot@vkrobot：~/catkin_ws/src/vkrobot_tutorials$<span class="w"> </span><span class="nb">cd</span><span class="w"> </span>msg
</span><span id="__span-52-4"><a id="__codelineno-52-4" name="__codelineno-52-4" href="#__codelineno-52-4"></a>vkrobot@vkrobot：~/catkin_ws/src/vkrobot_tutorials/msg$<span class="w"> </span>touch<span class="w"> </span>my_msgs.msg
</span></code></pre></div>
<p>编辑my_msgs.msg文件，添加以下内容：</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-53-1"><a id="__codelineno-53-1" name="__codelineno-53-1" href="#__codelineno-53-1"></a>string name
</span><span id="__span-53-2"><a id="__codelineno-53-2" name="__codelineno-53-2" href="#__codelineno-53-2"></a>uint8 age
</span><span id="__span-53-3"><a id="__codelineno-53-3" name="__codelineno-53-3" href="#__codelineno-53-3"></a>uint8 sex
</span><span id="__span-53-4"><a id="__codelineno-53-4" name="__codelineno-53-4" href="#__codelineno-53-4"></a>
</span><span id="__span-53-5"><a id="__codelineno-53-5" name="__codelineno-53-5" href="#__codelineno-53-5"></a>uint8 female = 0
</span><span id="__span-53-6"><a id="__codelineno-53-6" name="__codelineno-53-6" href="#__codelineno-53-6"></a>uint8 male = 1
</span></code></pre></div>
<p>编辑完成后，保存并退出，接下来我们还需要修改<code>package.xml</code>和<code>CMakeLists.txt</code>两个文件，确保msg文件能被转换为C++、Python或其他语言的源代码</p>
<ol>
<li>修改<code>package.xml</code></li>
</ol>
<p>​   添加以下依赖项：</p>
<div class="language-xml highlight"><pre><span></span><code><span id="__span-54-1"><a id="__codelineno-54-1" name="__codelineno-54-1" href="#__codelineno-54-1"></a><span class="w">  </span><span class="nt">&lt;build_depend&gt;</span>message_generation<span class="nt">&lt;/build_depend&gt;</span>
</span><span id="__span-54-2"><a id="__codelineno-54-2" name="__codelineno-54-2" href="#__codelineno-54-2"></a><span class="w">  </span><span class="nt">&lt;exec_depend&gt;</span>message_runtime<span class="nt">&lt;/exec_depend&gt;</span>
</span></code></pre></div>
<ol>
<li>修改<code>CMakeLists.txt</code></li>
</ol>
<div class="language-python highlight"><pre><span></span><code><span id="__span-55-1"><a id="__codelineno-55-1" name="__codelineno-55-1" href="#__codelineno-55-1"></a><span class="c1"># 在find_package中添加message_generation的依赖</span>
</span><span id="__span-55-2"><a id="__codelineno-55-2" name="__codelineno-55-2" href="#__codelineno-55-2"></a><span class="n">find_package</span><span class="p">(</span><span class="n">catkin</span> <span class="n">REQUIRED</span> <span class="n">COMPONENTS</span>
</span><span id="__span-55-3"><a id="__codelineno-55-3" name="__codelineno-55-3" href="#__codelineno-55-3"></a>   <span class="n">roscpp</span>
</span><span id="__span-55-4"><a id="__codelineno-55-4" name="__codelineno-55-4" href="#__codelineno-55-4"></a>   <span class="n">rospy</span>
</span><span id="__span-55-5"><a id="__codelineno-55-5" name="__codelineno-55-5" href="#__codelineno-55-5"></a>   <span class="n">std_msgs</span>
</span><span id="__span-55-6"><a id="__codelineno-55-6" name="__codelineno-55-6" href="#__codelineno-55-6"></a>   <span class="n">message_generation</span>
</span><span id="__span-55-7"><a id="__codelineno-55-7" name="__codelineno-55-7" href="#__codelineno-55-7"></a><span class="p">)</span>
</span><span id="__span-55-8"><a id="__codelineno-55-8" name="__codelineno-55-8" href="#__codelineno-55-8"></a>
</span><span id="__span-55-9"><a id="__codelineno-55-9" name="__codelineno-55-9" href="#__codelineno-55-9"></a><span class="c1"># 释放add_message_files块，并添加自定义的msg文件</span>
</span><span id="__span-55-10"><a id="__codelineno-55-10" name="__codelineno-55-10" href="#__codelineno-55-10"></a><span class="n">add_message_files</span><span class="p">(</span>
</span><span id="__span-55-11"><a id="__codelineno-55-11" name="__codelineno-55-11" href="#__codelineno-55-11"></a>  <span class="n">FILES</span>
</span><span id="__span-55-12"><a id="__codelineno-55-12" name="__codelineno-55-12" href="#__codelineno-55-12"></a>  <span class="n">my_msgs</span><span class="o">.</span><span class="n">msg</span>
</span><span id="__span-55-13"><a id="__codelineno-55-13" name="__codelineno-55-13" href="#__codelineno-55-13"></a><span class="p">)</span>
</span><span id="__span-55-14"><a id="__codelineno-55-14" name="__codelineno-55-14" href="#__codelineno-55-14"></a>
</span><span id="__span-55-15"><a id="__codelineno-55-15" name="__codelineno-55-15" href="#__codelineno-55-15"></a><span class="c1"># 释放generate_messages块，添加自定义消息依赖的所有功能包</span>
</span><span id="__span-55-16"><a id="__codelineno-55-16" name="__codelineno-55-16" href="#__codelineno-55-16"></a><span class="n">generate_messages</span><span class="p">(</span>
</span><span id="__span-55-17"><a id="__codelineno-55-17" name="__codelineno-55-17" href="#__codelineno-55-17"></a>  <span class="n">DEPENDENCIES</span>
</span><span id="__span-55-18"><a id="__codelineno-55-18" name="__codelineno-55-18" href="#__codelineno-55-18"></a>  <span class="n">std_msgs</span>
</span><span id="__span-55-19"><a id="__codelineno-55-19" name="__codelineno-55-19" href="#__codelineno-55-19"></a><span class="p">)</span>
</span><span id="__span-55-20"><a id="__codelineno-55-20" name="__codelineno-55-20" href="#__codelineno-55-20"></a>
</span><span id="__span-55-21"><a id="__codelineno-55-21" name="__codelineno-55-21" href="#__codelineno-55-21"></a><span class="c1"># 在catkin_package中添加message_runtime的依赖</span>
</span><span id="__span-55-22"><a id="__codelineno-55-22" name="__codelineno-55-22" href="#__codelineno-55-22"></a><span class="n">catkin_package</span><span class="p">(</span>
</span><span id="__span-55-23"><a id="__codelineno-55-23" name="__codelineno-55-23" href="#__codelineno-55-23"></a>  <span class="o">...</span>
</span><span id="__span-55-24"><a id="__codelineno-55-24" name="__codelineno-55-24" href="#__codelineno-55-24"></a>  <span class="n">CATKIN_DEPENDS</span> <span class="n">message_runtime</span> <span class="o">...</span>
</span><span id="__span-55-25"><a id="__codelineno-55-25" name="__codelineno-55-25" href="#__codelineno-55-25"></a>  <span class="o">...</span><span class="p">)</span>
</span></code></pre></div>
<p>两个文件都修改完成后，回到工作空间的根目录再次编译</p>
<div class="language-shell highlight"><pre><span></span><code><span id="__span-56-1"><a id="__codelineno-56-1" name="__codelineno-56-1" href="#__codelineno-56-1"></a>vkrobot@vkrobot：~$<span class="w"> </span><span class="nb">cd</span><span class="w"> </span>~/catkin_ws
</span><span id="__span-56-2"><a id="__codelineno-56-2" name="__codelineno-56-2" href="#__codelineno-56-2"></a>vkrobot@vkrobot：~/catkin_ws$<span class="w"> </span>catkin_make
</span></code></pre></div>
<p>以上就是创建消息的所有步骤。让我们通过<code>rosmsg show</code>命令看看ROS能否识别它</p>
<p><strong>用法：</strong><code>rosmsg show [message_type]</code></p>
<div class="language-shell highlight"><pre><span></span><code><span id="__span-57-1"><a id="__codelineno-57-1" name="__codelineno-57-1" href="#__codelineno-57-1"></a>vkrobot@vkrobot：~$<span class="w"> </span>rosmsg<span class="w"> </span>show<span class="w"> </span>vkrobot_tutorials/my_msgs
</span><span id="__span-57-2"><a id="__codelineno-57-2" name="__codelineno-57-2" href="#__codelineno-57-2"></a>uint8<span class="w"> </span><span class="nv">female</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0</span>
</span><span id="__span-57-3"><a id="__codelineno-57-3" name="__codelineno-57-3" href="#__codelineno-57-3"></a>uint8<span class="w"> </span><span class="nv">male</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1</span>
</span><span id="__span-57-4"><a id="__codelineno-57-4" name="__codelineno-57-4" href="#__codelineno-57-4"></a>string<span class="w"> </span>name
</span><span id="__span-57-5"><a id="__codelineno-57-5" name="__codelineno-57-5" href="#__codelineno-57-5"></a>uint8<span class="w"> </span>age
</span><span id="__span-57-6"><a id="__codelineno-57-6" name="__codelineno-57-6" href="#__codelineno-57-6"></a>uint8<span class="w"> </span>sex
</span><span id="__span-57-7"><a id="__codelineno-57-7" name="__codelineno-57-7" href="#__codelineno-57-7"></a>
</span><span id="__span-57-8"><a id="__codelineno-57-8" name="__codelineno-57-8" href="#__codelineno-57-8"></a>或
</span><span id="__span-57-9"><a id="__codelineno-57-9" name="__codelineno-57-9" href="#__codelineno-57-9"></a>
</span><span id="__span-57-10"><a id="__codelineno-57-10" name="__codelineno-57-10" href="#__codelineno-57-10"></a>vkrobot@vkrobot：~$<span class="w"> </span>rosmsg<span class="w"> </span>show<span class="w"> </span>my_msgs
</span><span id="__span-57-11"><a id="__codelineno-57-11" name="__codelineno-57-11" href="#__codelineno-57-11"></a><span class="o">[</span>vkrobot_tutorials/my_msgs<span class="o">]</span>：
</span><span id="__span-57-12"><a id="__codelineno-57-12" name="__codelineno-57-12" href="#__codelineno-57-12"></a>uint8<span class="w"> </span><span class="nv">female</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0</span>
</span><span id="__span-57-13"><a id="__codelineno-57-13" name="__codelineno-57-13" href="#__codelineno-57-13"></a>uint8<span class="w"> </span><span class="nv">male</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1</span>
</span><span id="__span-57-14"><a id="__codelineno-57-14" name="__codelineno-57-14" href="#__codelineno-57-14"></a>string<span class="w"> </span>name
</span><span id="__span-57-15"><a id="__codelineno-57-15" name="__codelineno-57-15" href="#__codelineno-57-15"></a>uint8<span class="w"> </span>age
</span><span id="__span-57-16"><a id="__codelineno-57-16" name="__codelineno-57-16" href="#__codelineno-57-16"></a>uint8<span class="w"> </span>sex
</span></code></pre></div>
<h4 id="_6">练习</h4>
<p>试着创建一个发布者节点和一个订阅者节点，传递自定义的消息吧😀</p>
<p><code>my_talker.py</code></p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-58-1"><a id="__codelineno-58-1" name="__codelineno-58-1" href="#__codelineno-58-1"></a><span class="ch">#! /usr/bin/env python3</span>
</span><span id="__span-58-2"><a id="__codelineno-58-2" name="__codelineno-58-2" href="#__codelineno-58-2"></a>
</span><span id="__span-58-3"><a id="__codelineno-58-3" name="__codelineno-58-3" href="#__codelineno-58-3"></a><span class="kn">import</span> <span class="nn">rospy</span>
</span><span id="__span-58-4"><a id="__codelineno-58-4" name="__codelineno-58-4" href="#__codelineno-58-4"></a><span class="kn">from</span> <span class="nn">vkrobot_tutorials.msg</span> <span class="kn">import</span> <span class="n">my_msgs</span>
</span><span id="__span-58-5"><a id="__codelineno-58-5" name="__codelineno-58-5" href="#__codelineno-58-5"></a>
</span><span id="__span-58-6"><a id="__codelineno-58-6" name="__codelineno-58-6" href="#__codelineno-58-6"></a><span class="k">def</span> <span class="nf">talker</span><span class="p">()</span><span class="err">：</span>
</span><span id="__span-58-7"><a id="__codelineno-58-7" name="__codelineno-58-7" href="#__codelineno-58-7"></a>    <span class="n">pub</span> <span class="o">=</span> <span class="n">rospy</span><span class="o">.</span><span class="n">Publisher</span><span class="p">(</span><span class="s1">&#39;chatter&#39;</span><span class="p">,</span> <span class="n">my_msgs</span><span class="p">,</span> <span class="n">queue_size</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
</span><span id="__span-58-8"><a id="__codelineno-58-8" name="__codelineno-58-8" href="#__codelineno-58-8"></a>    <span class="n">rospy</span><span class="o">.</span><span class="n">init_node</span><span class="p">(</span><span class="s1">&#39;talker&#39;</span><span class="p">,</span> <span class="n">anonymous</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="__span-58-9"><a id="__codelineno-58-9" name="__codelineno-58-9" href="#__codelineno-58-9"></a>
</span><span id="__span-58-10"><a id="__codelineno-58-10" name="__codelineno-58-10" href="#__codelineno-58-10"></a>    <span class="n">rate</span> <span class="o">=</span> <span class="n">rospy</span><span class="o">.</span><span class="n">Rate</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
</span><span id="__span-58-11"><a id="__codelineno-58-11" name="__codelineno-58-11" href="#__codelineno-58-11"></a>    <span class="k">while</span> <span class="ow">not</span> <span class="n">rospy</span><span class="o">.</span><span class="n">is_shutdown</span><span class="p">()</span><span class="err">：</span>
</span><span id="__span-58-12"><a id="__codelineno-58-12" name="__codelineno-58-12" href="#__codelineno-58-12"></a>        <span class="n">msg</span> <span class="o">=</span> <span class="n">my_msgs</span><span class="p">()</span>
</span><span id="__span-58-13"><a id="__codelineno-58-13" name="__codelineno-58-13" href="#__codelineno-58-13"></a>        <span class="n">msg</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;xiaowei&quot;</span>
</span><span id="__span-58-14"><a id="__codelineno-58-14" name="__codelineno-58-14" href="#__codelineno-58-14"></a>        <span class="n">msg</span><span class="o">.</span><span class="n">age</span> <span class="o">=</span> <span class="mi">7</span>
</span><span id="__span-58-15"><a id="__codelineno-58-15" name="__codelineno-58-15" href="#__codelineno-58-15"></a>        <span class="n">msg</span><span class="o">.</span><span class="n">sex</span> <span class="o">=</span> <span class="n">msg</span><span class="o">.</span><span class="n">male</span>  <span class="c1"># or msg.sex = msg.female</span>
</span><span id="__span-58-16"><a id="__codelineno-58-16" name="__codelineno-58-16" href="#__codelineno-58-16"></a>        <span class="n">pub</span><span class="o">.</span><span class="n">publish</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
</span><span id="__span-58-17"><a id="__codelineno-58-17" name="__codelineno-58-17" href="#__codelineno-58-17"></a>        <span class="n">rate</span><span class="o">.</span><span class="n">sleep</span><span class="p">()</span>
</span><span id="__span-58-18"><a id="__codelineno-58-18" name="__codelineno-58-18" href="#__codelineno-58-18"></a>
</span><span id="__span-58-19"><a id="__codelineno-58-19" name="__codelineno-58-19" href="#__codelineno-58-19"></a><span class="k">if</span> <span class="vm">__name__</span>  <span class="s1">&#39;__main__&#39;</span><span class="err">：</span>
</span><span id="__span-58-20"><a id="__codelineno-58-20" name="__codelineno-58-20" href="#__codelineno-58-20"></a>    <span class="k">try</span><span class="err">：</span>
</span><span id="__span-58-21"><a id="__codelineno-58-21" name="__codelineno-58-21" href="#__codelineno-58-21"></a>        <span class="n">talker</span><span class="p">()</span>
</span><span id="__span-58-22"><a id="__codelineno-58-22" name="__codelineno-58-22" href="#__codelineno-58-22"></a>    <span class="k">except</span> <span class="n">rospy</span><span class="o">.</span><span class="n">ROSInterruptException</span><span class="err">：</span>
</span><span id="__span-58-23"><a id="__codelineno-58-23" name="__codelineno-58-23" href="#__codelineno-58-23"></a>        <span class="k">pass</span>
</span></code></pre></div>
<p><code>my_listener.py</code></p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-59-1"><a id="__codelineno-59-1" name="__codelineno-59-1" href="#__codelineno-59-1"></a><span class="ch">#! /usr/bin/env python3</span>
</span><span id="__span-59-2"><a id="__codelineno-59-2" name="__codelineno-59-2" href="#__codelineno-59-2"></a>
</span><span id="__span-59-3"><a id="__codelineno-59-3" name="__codelineno-59-3" href="#__codelineno-59-3"></a><span class="kn">import</span> <span class="nn">rospy</span>
</span><span id="__span-59-4"><a id="__codelineno-59-4" name="__codelineno-59-4" href="#__codelineno-59-4"></a><span class="kn">from</span> <span class="nn">vkrobot_tutorials.msg</span> <span class="kn">import</span> <span class="n">my_msgs</span>
</span><span id="__span-59-5"><a id="__codelineno-59-5" name="__codelineno-59-5" href="#__codelineno-59-5"></a>
</span><span id="__span-59-6"><a id="__codelineno-59-6" name="__codelineno-59-6" href="#__codelineno-59-6"></a><span class="k">def</span> <span class="nf">listener</span><span class="p">()</span><span class="err">：</span>
</span><span id="__span-59-7"><a id="__codelineno-59-7" name="__codelineno-59-7" href="#__codelineno-59-7"></a>    <span class="n">rospy</span><span class="o">.</span><span class="n">init_node</span><span class="p">(</span><span class="s1">&#39;listener&#39;</span><span class="p">,</span> <span class="n">anonymous</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="__span-59-8"><a id="__codelineno-59-8" name="__codelineno-59-8" href="#__codelineno-59-8"></a>    <span class="n">rospy</span><span class="o">.</span><span class="n">Subscriber</span><span class="p">(</span><span class="s1">&#39;chatter&#39;</span><span class="p">,</span> <span class="n">my_msgs</span><span class="p">,</span> <span class="n">callback</span><span class="p">)</span>
</span><span id="__span-59-9"><a id="__codelineno-59-9" name="__codelineno-59-9" href="#__codelineno-59-9"></a>    <span class="n">rospy</span><span class="o">.</span><span class="n">spin</span><span class="p">()</span>
</span><span id="__span-59-10"><a id="__codelineno-59-10" name="__codelineno-59-10" href="#__codelineno-59-10"></a>
</span><span id="__span-59-11"><a id="__codelineno-59-11" name="__codelineno-59-11" href="#__codelineno-59-11"></a><span class="k">def</span> <span class="nf">callback</span><span class="p">(</span><span class="n">data</span><span class="p">)</span><span class="err">：</span>
</span><span id="__span-59-12"><a id="__codelineno-59-12" name="__codelineno-59-12" href="#__codelineno-59-12"></a>    <span class="n">rospy</span><span class="o">.</span><span class="n">loginfo</span><span class="p">(</span><span class="n">rospy</span><span class="o">.</span><span class="n">get_caller_id</span><span class="p">()</span> <span class="o">+</span> <span class="s2">&quot; I heard </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>
</span><span id="__span-59-13"><a id="__codelineno-59-13" name="__codelineno-59-13" href="#__codelineno-59-13"></a>
</span><span id="__span-59-14"><a id="__codelineno-59-14" name="__codelineno-59-14" href="#__codelineno-59-14"></a><span class="k">if</span> <span class="vm">__name__</span>  <span class="s1">&#39;__main__&#39;</span><span class="err">：</span>
</span><span id="__span-59-15"><a id="__codelineno-59-15" name="__codelineno-59-15" href="#__codelineno-59-15"></a>    <span class="n">listener</span><span class="p">()</span>
</span></code></pre></div>
<h4 id="_7">复习</h4>
<p>总结一下本小节中我们接触过的命令：</p>
<ul>
<li>rosmsg = ros + msg：提供与ROS消息定义相关的信息</li>
</ul>
<h2 id="26">2.6 服务通信</h2>
<h3 id="261">2.6.1 自定义服务类型</h3>
<ul>
<li>srv（服务）：一个srv文件描述一个服务。它由两部分组成：请求（request）和响应（response）。</li>
</ul>
<p>srv文件和msg文件一样，只是它们包含两个部分：请求和响应。这两部分用一条<code>---</code>线隔开。下面是一个srv文件的示例：</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-60-1"><a id="__codelineno-60-1" name="__codelineno-60-1" href="#__codelineno-60-1"></a>int64 A
</span><span id="__span-60-2"><a id="__codelineno-60-2" name="__codelineno-60-2" href="#__codelineno-60-2"></a>int64 B
</span><span id="__span-60-3"><a id="__codelineno-60-3" name="__codelineno-60-3" href="#__codelineno-60-3"></a>---
</span><span id="__span-60-4"><a id="__codelineno-60-4" name="__codelineno-60-4" href="#__codelineno-60-4"></a>int64 sum
</span></code></pre></div>
<p>让我们使用之前创建的包再来创建服务：</p>
<div class="language-shell highlight"><pre><span></span><code><span id="__span-61-1"><a id="__codelineno-61-1" name="__codelineno-61-1" href="#__codelineno-61-1"></a>vkrobot@vkrobot：~$<span class="w"> </span>roscd<span class="w"> </span>vkrobot_tutorials
</span><span id="__span-61-2"><a id="__codelineno-61-2" name="__codelineno-61-2" href="#__codelineno-61-2"></a>vkrobot@vkrobot：~/catkin_ws/src/vkrobot_tutorials$<span class="w"> </span>mkdir<span class="w"> </span>srv
</span></code></pre></div>
<p>我们将从另一个包复制现有的srv定义，而不是手动创建新的srv。<code>roscp</code>是一个实用的命令行工具，用于将文件从一个包复制到另一个包。</p>
<p><strong>用法：</strong><code>roscp [package_name] [file_to_copy_path] [copy_path]</code></p>
<p>现在我们可以从<code>rospy_tutorials</code>包中复制一个服务：</p>
<div class="language-shell highlight"><pre><span></span><code><span id="__span-62-1"><a id="__codelineno-62-1" name="__codelineno-62-1" href="#__codelineno-62-1"></a>vkrobot@vkrobot：~/catkin_ws/src/vkrobot_tutorials$<span class="w"> </span>roscp<span class="w"> </span>rospy_tutorials<span class="w"> </span>AddTwoInts.srv<span class="w"> </span>srv/AddTwoInts.srv
</span></code></pre></div>
<blockquote>
<p>⚠⚠⚠注意此时的终端路径！！！</p>
</blockquote>
<p>接下来我们还需要修改<code>package.xml</code>和<code>CMakeLists.txt</code>两个文件，确保srv文件能被转换为C++、Python或其他语言的源代码</p>
<ol>
<li>修改<code>package.xml</code></li>
</ol>
<p>​   添加以下依赖项：</p>
<div class="language-xml highlight"><pre><span></span><code><span id="__span-63-1"><a id="__codelineno-63-1" name="__codelineno-63-1" href="#__codelineno-63-1"></a><span class="w">  </span><span class="nt">&lt;build_depend&gt;</span>message_generation<span class="nt">&lt;/build_depend&gt;</span>
</span><span id="__span-63-2"><a id="__codelineno-63-2" name="__codelineno-63-2" href="#__codelineno-63-2"></a><span class="w">  </span><span class="nt">&lt;exec_depend&gt;</span>message_runtime<span class="nt">&lt;/exec_depend&gt;</span>
</span></code></pre></div>
<blockquote>
<p>在自定义msg时，如果已经做过相同的操作，可以跳过此步</p>
</blockquote>
<ol>
<li>修改<code>CMakeLists.txt</code></li>
</ol>
<div class="language-python highlight"><pre><span></span><code><span id="__span-64-1"><a id="__codelineno-64-1" name="__codelineno-64-1" href="#__codelineno-64-1"></a><span class="c1"># 在find_package中添加message_generation的依赖</span>
</span><span id="__span-64-2"><a id="__codelineno-64-2" name="__codelineno-64-2" href="#__codelineno-64-2"></a><span class="n">find_package</span><span class="p">(</span><span class="n">catkin</span> <span class="n">REQUIRED</span> <span class="n">COMPONENTS</span>
</span><span id="__span-64-3"><a id="__codelineno-64-3" name="__codelineno-64-3" href="#__codelineno-64-3"></a>   <span class="n">roscpp</span>
</span><span id="__span-64-4"><a id="__codelineno-64-4" name="__codelineno-64-4" href="#__codelineno-64-4"></a>   <span class="n">rospy</span>
</span><span id="__span-64-5"><a id="__codelineno-64-5" name="__codelineno-64-5" href="#__codelineno-64-5"></a>   <span class="n">std_msgs</span>
</span><span id="__span-64-6"><a id="__codelineno-64-6" name="__codelineno-64-6" href="#__codelineno-64-6"></a>   <span class="n">message_generation</span>
</span><span id="__span-64-7"><a id="__codelineno-64-7" name="__codelineno-64-7" href="#__codelineno-64-7"></a><span class="p">)</span>
</span><span id="__span-64-8"><a id="__codelineno-64-8" name="__codelineno-64-8" href="#__codelineno-64-8"></a>
</span><span id="__span-64-9"><a id="__codelineno-64-9" name="__codelineno-64-9" href="#__codelineno-64-9"></a><span class="c1"># 释放generate_messages块，添加自定义消息依赖的所有功能包</span>
</span><span id="__span-64-10"><a id="__codelineno-64-10" name="__codelineno-64-10" href="#__codelineno-64-10"></a><span class="n">generate_messages</span><span class="p">(</span>
</span><span id="__span-64-11"><a id="__codelineno-64-11" name="__codelineno-64-11" href="#__codelineno-64-11"></a>  <span class="n">DEPENDENCIES</span>
</span><span id="__span-64-12"><a id="__codelineno-64-12" name="__codelineno-64-12" href="#__codelineno-64-12"></a>  <span class="n">std_msgs</span>
</span><span id="__span-64-13"><a id="__codelineno-64-13" name="__codelineno-64-13" href="#__codelineno-64-13"></a><span class="p">)</span>
</span><span id="__span-64-14"><a id="__codelineno-64-14" name="__codelineno-64-14" href="#__codelineno-64-14"></a>
</span><span id="__span-64-15"><a id="__codelineno-64-15" name="__codelineno-64-15" href="#__codelineno-64-15"></a><span class="c1"># 在catkin_package中添加message_runtime的依赖</span>
</span><span id="__span-64-16"><a id="__codelineno-64-16" name="__codelineno-64-16" href="#__codelineno-64-16"></a><span class="n">catkin_package</span><span class="p">(</span>
</span><span id="__span-64-17"><a id="__codelineno-64-17" name="__codelineno-64-17" href="#__codelineno-64-17"></a>  <span class="o">...</span>
</span><span id="__span-64-18"><a id="__codelineno-64-18" name="__codelineno-64-18" href="#__codelineno-64-18"></a>  <span class="n">CATKIN_DEPENDS</span> <span class="n">message_runtime</span> <span class="o">...</span>
</span><span id="__span-64-19"><a id="__codelineno-64-19" name="__codelineno-64-19" href="#__codelineno-64-19"></a>  <span class="o">...</span><span class="p">)</span>
</span><span id="__span-64-20"><a id="__codelineno-64-20" name="__codelineno-64-20" href="#__codelineno-64-20"></a>
</span><span id="__span-64-21"><a id="__codelineno-64-21" name="__codelineno-64-21" href="#__codelineno-64-21"></a><span class="c1"># 👆👆👆上面的内容如果在自定义msg时已做过相同操作可跳过👆👆👆</span>
</span><span id="__span-64-22"><a id="__codelineno-64-22" name="__codelineno-64-22" href="#__codelineno-64-22"></a>
</span><span id="__span-64-23"><a id="__codelineno-64-23" name="__codelineno-64-23" href="#__codelineno-64-23"></a><span class="c1"># 释放add_service_files块，并添加自定义的msg文件</span>
</span><span id="__span-64-24"><a id="__codelineno-64-24" name="__codelineno-64-24" href="#__codelineno-64-24"></a><span class="n">add_service_files</span><span class="p">(</span>
</span><span id="__span-64-25"><a id="__codelineno-64-25" name="__codelineno-64-25" href="#__codelineno-64-25"></a>  <span class="n">FILES</span>
</span><span id="__span-64-26"><a id="__codelineno-64-26" name="__codelineno-64-26" href="#__codelineno-64-26"></a>  <span class="n">AddTwoInts</span><span class="o">.</span><span class="n">srv</span>
</span><span id="__span-64-27"><a id="__codelineno-64-27" name="__codelineno-64-27" href="#__codelineno-64-27"></a><span class="p">)</span>
</span></code></pre></div>
<p>两个文件都修改完成后，回到工作空间的根目录再次编译</p>
<div class="language-shell highlight"><pre><span></span><code><span id="__span-65-1"><a id="__codelineno-65-1" name="__codelineno-65-1" href="#__codelineno-65-1"></a>vkrobot@vkrobot：~$<span class="w"> </span><span class="nb">cd</span><span class="w"> </span>~/catkin_ws
</span><span id="__span-65-2"><a id="__codelineno-65-2" name="__codelineno-65-2" href="#__codelineno-65-2"></a>vkrobot@vkrobot：~/catkin_ws$<span class="w"> </span>catkin_make
</span></code></pre></div>
<p>以上就是创建消息的所有步骤。让我们通过<code>rossrv show</code>命令看看ROS能否识别它</p>
<p><strong>用法：</strong><code>rossrv show &lt;message_type&gt;</code></p>
<div class="language-shell highlight"><pre><span></span><code><span id="__span-66-1"><a id="__codelineno-66-1" name="__codelineno-66-1" href="#__codelineno-66-1"></a>vkrobot@vkrobot：~$<span class="w"> </span>rossrv<span class="w"> </span>show<span class="w"> </span>vkrobot_tutorials/AddTwoInts
</span><span id="__span-66-2"><a id="__codelineno-66-2" name="__codelineno-66-2" href="#__codelineno-66-2"></a>int64<span class="w"> </span>a
</span><span id="__span-66-3"><a id="__codelineno-66-3" name="__codelineno-66-3" href="#__codelineno-66-3"></a>int64<span class="w"> </span>b
</span><span id="__span-66-4"><a id="__codelineno-66-4" name="__codelineno-66-4" href="#__codelineno-66-4"></a>---
</span><span id="__span-66-5"><a id="__codelineno-66-5" name="__codelineno-66-5" href="#__codelineno-66-5"></a>int64<span class="w"> </span>sum
</span><span id="__span-66-6"><a id="__codelineno-66-6" name="__codelineno-66-6" href="#__codelineno-66-6"></a>
</span><span id="__span-66-7"><a id="__codelineno-66-7" name="__codelineno-66-7" href="#__codelineno-66-7"></a>或
</span><span id="__span-66-8"><a id="__codelineno-66-8" name="__codelineno-66-8" href="#__codelineno-66-8"></a>
</span><span id="__span-66-9"><a id="__codelineno-66-9" name="__codelineno-66-9" href="#__codelineno-66-9"></a>vkrobot@vkrobot：~$<span class="w"> </span>rosmsg<span class="w"> </span>show<span class="w"> </span>AddTwoInts
</span><span id="__span-66-10"><a id="__codelineno-66-10" name="__codelineno-66-10" href="#__codelineno-66-10"></a><span class="o">[</span>vkrobot_tutorials/AddTwoInts<span class="o">]</span>：
</span><span id="__span-66-11"><a id="__codelineno-66-11" name="__codelineno-66-11" href="#__codelineno-66-11"></a>int64<span class="w"> </span>a
</span><span id="__span-66-12"><a id="__codelineno-66-12" name="__codelineno-66-12" href="#__codelineno-66-12"></a>int64<span class="w"> </span>b
</span><span id="__span-66-13"><a id="__codelineno-66-13" name="__codelineno-66-13" href="#__codelineno-66-13"></a>---
</span><span id="__span-66-14"><a id="__codelineno-66-14" name="__codelineno-66-14" href="#__codelineno-66-14"></a>int64<span class="w"> </span>sum
</span><span id="__span-66-15"><a id="__codelineno-66-15" name="__codelineno-66-15" href="#__codelineno-66-15"></a>
</span><span id="__span-66-16"><a id="__codelineno-66-16" name="__codelineno-66-16" href="#__codelineno-66-16"></a><span class="o">[</span>rospy_tutorials/AddTwoInts<span class="o">]</span>：
</span><span id="__span-66-17"><a id="__codelineno-66-17" name="__codelineno-66-17" href="#__codelineno-66-17"></a>int64<span class="w"> </span>a
</span><span id="__span-66-18"><a id="__codelineno-66-18" name="__codelineno-66-18" href="#__codelineno-66-18"></a>int64<span class="w"> </span>b
</span><span id="__span-66-19"><a id="__codelineno-66-19" name="__codelineno-66-19" href="#__codelineno-66-19"></a>---
</span><span id="__span-66-20"><a id="__codelineno-66-20" name="__codelineno-66-20" href="#__codelineno-66-20"></a>int64<span class="w"> </span>sum
</span></code></pre></div>
<blockquote>
<p>这里显示了两个服务。第一个是刚刚在vkrobot_tutorials包中创建的，第二个是之前rospy_tutorials包中已经存在的。</p>
</blockquote>
<h4 id="_8">复习</h4>
<p>总结一下本小节中我们接触过的命令：</p>
<ul>
<li>roscp = ros + cp：将文件从ROS包复制到ROS包</li>
<li>rossrv = ros + srv：提供与ROS服务定义相关的信息</li>
</ul>
<h3 id="262">2.6.2 服务器节点编程实现</h3>
<div class="language-shell highlight"><pre><span></span><code><span id="__span-67-1"><a id="__codelineno-67-1" name="__codelineno-67-1" href="#__codelineno-67-1"></a>vkrobot@vkrobot：~$<span class="w"> </span>roscd<span class="w"> </span>vkrobot_tutorials/scripts
</span><span id="__span-67-2"><a id="__codelineno-67-2" name="__codelineno-67-2" href="#__codelineno-67-2"></a>vkrobot@vkrobot：~/catkin_ws/src/vkrobot_tutorials/scripts$<span class="w"> </span>touch<span class="w"> </span>add_two_ints_server.py
</span><span id="__span-67-3"><a id="__codelineno-67-3" name="__codelineno-67-3" href="#__codelineno-67-3"></a>vkrobot@vkrobot：~/catkin_ws/src/vkrobot_tutorials/scripts$<span class="w"> </span>chmod<span class="w"> </span>+x<span class="w"> </span>add_two_ints_server.py<span class="w">  </span><span class="c1">#添加可执行权限</span>
</span></code></pre></div>
<p>编辑add_two_ints_server.py文件，添加以下内容：</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-68-1"><a id="__codelineno-68-1" name="__codelineno-68-1" href="#__codelineno-68-1"></a><span class="ch">#!/usr/bin/env python3</span>
</span><span id="__span-68-2"><a id="__codelineno-68-2" name="__codelineno-68-2" href="#__codelineno-68-2"></a><span class="c1">#每个Python ROS节点的最开头都有这个声明</span>
</span><span id="__span-68-3"><a id="__codelineno-68-3" name="__codelineno-68-3" href="#__codelineno-68-3"></a>
</span><span id="__span-68-4"><a id="__codelineno-68-4" name="__codelineno-68-4" href="#__codelineno-68-4"></a><span class="kn">import</span> <span class="nn">rospy</span>  <span class="c1">#如果要使用python编写ROS节点，都需要导入rospy</span>
</span><span id="__span-68-5"><a id="__codelineno-68-5" name="__codelineno-68-5" href="#__codelineno-68-5"></a><span class="c1">#导入自定义的服务数据类型与响应</span>
</span><span id="__span-68-6"><a id="__codelineno-68-6" name="__codelineno-68-6" href="#__codelineno-68-6"></a><span class="kn">from</span> <span class="nn">vkrobot_tutorials.srv</span> <span class="kn">import</span> <span class="n">AddTwoInts</span><span class="p">,</span><span class="n">AddTwoIntsResponse</span>
</span><span id="__span-68-7"><a id="__codelineno-68-7" name="__codelineno-68-7" href="#__codelineno-68-7"></a>
</span><span id="__span-68-8"><a id="__codelineno-68-8" name="__codelineno-68-8" href="#__codelineno-68-8"></a><span class="k">def</span> <span class="nf">callback</span><span class="p">(</span><span class="n">req</span><span class="p">)</span><span class="err">：</span>
</span><span id="__span-68-9"><a id="__codelineno-68-9" name="__codelineno-68-9" href="#__codelineno-68-9"></a>    <span class="c1">#终端打印信息</span>
</span><span id="__span-68-10"><a id="__codelineno-68-10" name="__codelineno-68-10" href="#__codelineno-68-10"></a>    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Returning [</span><span class="si">%s</span><span class="s2"> + </span><span class="si">%s</span><span class="s2"> = </span><span class="si">%s</span><span class="s2">]&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">req</span><span class="o">.</span><span class="n">a</span><span class="p">,</span> <span class="n">req</span><span class="o">.</span><span class="n">b</span><span class="p">,</span> <span class="p">(</span><span class="n">req</span><span class="o">.</span><span class="n">a</span> <span class="o">+</span> <span class="n">req</span><span class="o">.</span><span class="n">b</span><span class="p">)))</span>
</span><span id="__span-68-11"><a id="__codelineno-68-11" name="__codelineno-68-11" href="#__codelineno-68-11"></a>    <span class="c1">#发送响应信息</span>
</span><span id="__span-68-12"><a id="__codelineno-68-12" name="__codelineno-68-12" href="#__codelineno-68-12"></a>    <span class="k">return</span> <span class="n">AddTwoIntsResponse</span><span class="p">(</span><span class="n">req</span><span class="o">.</span><span class="n">a</span> <span class="o">+</span> <span class="n">req</span><span class="o">.</span><span class="n">b</span><span class="p">)</span>
</span><span id="__span-68-13"><a id="__codelineno-68-13" name="__codelineno-68-13" href="#__codelineno-68-13"></a>
</span><span id="__span-68-14"><a id="__codelineno-68-14" name="__codelineno-68-14" href="#__codelineno-68-14"></a><span class="k">def</span> <span class="nf">add_two_ints_server</span><span class="p">()</span><span class="err">：</span>
</span><span id="__span-68-15"><a id="__codelineno-68-15" name="__codelineno-68-15" href="#__codelineno-68-15"></a>    <span class="c1">#初始化ROS节点，参数为节点名称</span>
</span><span id="__span-68-16"><a id="__codelineno-68-16" name="__codelineno-68-16" href="#__codelineno-68-16"></a>    <span class="n">rospy</span><span class="o">.</span><span class="n">init_node</span><span class="p">(</span><span class="s1">&#39;add_two_ints_server&#39;</span><span class="p">)</span>
</span><span id="__span-68-17"><a id="__codelineno-68-17" name="__codelineno-68-17" href="#__codelineno-68-17"></a>    <span class="c1">#向ROS Master注册节点信息，参数包括（服务名称，服务类型，回调函数）</span>
</span><span id="__span-68-18"><a id="__codelineno-68-18" name="__codelineno-68-18" href="#__codelineno-68-18"></a>    <span class="n">s</span> <span class="o">=</span> <span class="n">rospy</span><span class="o">.</span><span class="n">Service</span><span class="p">(</span><span class="s1">&#39;add_two_ints&#39;</span><span class="p">,</span> <span class="n">AddTwoInts</span><span class="p">,</span> <span class="n">callback</span><span class="p">)</span>
</span><span id="__span-68-19"><a id="__codelineno-68-19" name="__codelineno-68-19" href="#__codelineno-68-19"></a>    <span class="c1">#终端打印信息</span>
</span><span id="__span-68-20"><a id="__codelineno-68-20" name="__codelineno-68-20" href="#__codelineno-68-20"></a>    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Ready to add two ints.&quot;</span><span class="p">)</span>
</span><span id="__span-68-21"><a id="__codelineno-68-21" name="__codelineno-68-21" href="#__codelineno-68-21"></a>    <span class="c1">#阻塞循环，等待客户端请求，一旦接收到请求则进入回调函数进行处理</span>
</span><span id="__span-68-22"><a id="__codelineno-68-22" name="__codelineno-68-22" href="#__codelineno-68-22"></a>    <span class="n">rospy</span><span class="o">.</span><span class="n">spin</span><span class="p">()</span>
</span><span id="__span-68-23"><a id="__codelineno-68-23" name="__codelineno-68-23" href="#__codelineno-68-23"></a>
</span><span id="__span-68-24"><a id="__codelineno-68-24" name="__codelineno-68-24" href="#__codelineno-68-24"></a><span class="k">if</span> <span class="vm">__name__</span>  <span class="s1">&#39;__main__&#39;</span><span class="err">：</span>
</span><span id="__span-68-25"><a id="__codelineno-68-25" name="__codelineno-68-25" href="#__codelineno-68-25"></a>    <span class="n">add_two_ints_server</span><span class="p">()</span>
</span></code></pre></div>
<p>运行add_two_ints_server节点：</p>
<div class="language-shell highlight"><pre><span></span><code><span id="__span-69-1"><a id="__codelineno-69-1" name="__codelineno-69-1" href="#__codelineno-69-1"></a>vkrobot@vkrobot：~$<span class="w"> </span>roscore<span class="w"> </span><span class="c1">#先启动ROS Master</span>
</span><span id="__span-69-2"><a id="__codelineno-69-2" name="__codelineno-69-2" href="#__codelineno-69-2"></a>vkrobot@vkrobot：~$<span class="w"> </span>rosrun<span class="w"> </span>vkrobot_tutorials<span class="w"> </span>add_two_ints_server.py
</span></code></pre></div>
<p>运行成功后，打开一个新终端调用服务：</p>
<div class="language-shell highlight"><pre><span></span><code><span id="__span-70-1"><a id="__codelineno-70-1" name="__codelineno-70-1" href="#__codelineno-70-1"></a>vkrobot@vkrobot：~$<span class="w"> </span>rosservice<span class="w"> </span>call<span class="w"> </span>add_two_ints<span class="w"> </span>“a：<span class="w"> </span><span class="m">2</span>
</span><span id="__span-70-2"><a id="__codelineno-70-2" name="__codelineno-70-2" href="#__codelineno-70-2"></a>b：<span class="w"> </span><span class="m">3</span>”
</span><span id="__span-70-3"><a id="__codelineno-70-3" name="__codelineno-70-3" href="#__codelineno-70-3"></a>sum：<span class="w"> </span><span class="m">5</span>
</span></code></pre></div>
<h3 id="263">2.6.3 客户端节点编程实现</h3>
<div class="language-shell highlight"><pre><span></span><code><span id="__span-71-1"><a id="__codelineno-71-1" name="__codelineno-71-1" href="#__codelineno-71-1"></a>vkrobot@vkrobot：~$<span class="w"> </span>roscd<span class="w"> </span>vkrobot_tutorials/scripts
</span><span id="__span-71-2"><a id="__codelineno-71-2" name="__codelineno-71-2" href="#__codelineno-71-2"></a>vkrobot@vkrobot：~/catkin_ws/src/vkrobot_tutorials/scripts$<span class="w"> </span>touch<span class="w"> </span>add_two_ints_client.py
</span><span id="__span-71-3"><a id="__codelineno-71-3" name="__codelineno-71-3" href="#__codelineno-71-3"></a>vkrobot@vkrobot：~/catkin_ws/src/vkrobot_tutorials/scripts$<span class="w"> </span>chmod<span class="w"> </span>+x<span class="w"> </span>add_two_ints_client.py<span class="w">  </span><span class="c1">#添加可执行权限</span>
</span></code></pre></div>
<p>编辑add_two_ints_client.py文件，添加以下内容：</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-72-1"><a id="__codelineno-72-1" name="__codelineno-72-1" href="#__codelineno-72-1"></a><span class="ch">#!/usr/bin/env python3</span>
</span><span id="__span-72-2"><a id="__codelineno-72-2" name="__codelineno-72-2" href="#__codelineno-72-2"></a><span class="c1">#每个Python ROS节点的最开头都有这个声明</span>
</span><span id="__span-72-3"><a id="__codelineno-72-3" name="__codelineno-72-3" href="#__codelineno-72-3"></a>
</span><span id="__span-72-4"><a id="__codelineno-72-4" name="__codelineno-72-4" href="#__codelineno-72-4"></a><span class="kn">import</span> <span class="nn">rospy</span>  <span class="c1">#如果要使用python编写ROS节点，都需要导入rospy</span>
</span><span id="__span-72-5"><a id="__codelineno-72-5" name="__codelineno-72-5" href="#__codelineno-72-5"></a><span class="kn">from</span> <span class="nn">vkrobot_tutorials.srv</span> <span class="kn">import</span> <span class="o">*</span>  <span class="c1">#导入自定义的服务数据类型</span>
</span><span id="__span-72-6"><a id="__codelineno-72-6" name="__codelineno-72-6" href="#__codelineno-72-6"></a><span class="kn">import</span> <span class="nn">sys</span>  <span class="c1">#用于获取命令行参数</span>
</span><span id="__span-72-7"><a id="__codelineno-72-7" name="__codelineno-72-7" href="#__codelineno-72-7"></a>
</span><span id="__span-72-8"><a id="__codelineno-72-8" name="__codelineno-72-8" href="#__codelineno-72-8"></a><span class="k">def</span> <span class="nf">add_two_ints_client</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span><span class="err">：</span>
</span><span id="__span-72-9"><a id="__codelineno-72-9" name="__codelineno-72-9" href="#__codelineno-72-9"></a>    <span class="c1">#调用此方法可以让程序在服务可用之前一直阻塞</span>
</span><span id="__span-72-10"><a id="__codelineno-72-10" name="__codelineno-72-10" href="#__codelineno-72-10"></a>    <span class="n">rospy</span><span class="o">.</span><span class="n">wait_for_service</span><span class="p">(</span><span class="s1">&#39;add_two_ints&#39;</span><span class="p">)</span>
</span><span id="__span-72-11"><a id="__codelineno-72-11" name="__codelineno-72-11" href="#__codelineno-72-11"></a>    <span class="k">try</span><span class="err">：</span>
</span><span id="__span-72-12"><a id="__codelineno-72-12" name="__codelineno-72-12" href="#__codelineno-72-12"></a>        <span class="c1">#为服务的调用创建了一个句柄（handle），然后我们就可以使用这个句柄，像普通函数一样调用它，参数（服务名称，服务数据类型）</span>
</span><span id="__span-72-13"><a id="__codelineno-72-13" name="__codelineno-72-13" href="#__codelineno-72-13"></a>        <span class="n">add_two_ints</span> <span class="o">=</span> <span class="n">rospy</span><span class="o">.</span><span class="n">ServiceProxy</span><span class="p">(</span><span class="s1">&#39;add_two_ints&#39;</span><span class="p">,</span> <span class="n">AddTwoInts</span><span class="p">)</span>
</span><span id="__span-72-14"><a id="__codelineno-72-14" name="__codelineno-72-14" href="#__codelineno-72-14"></a>        <span class="c1">#获取服务器响应</span>
</span><span id="__span-72-15"><a id="__codelineno-72-15" name="__codelineno-72-15" href="#__codelineno-72-15"></a>        <span class="n">response</span> <span class="o">=</span> <span class="n">add_two_ints</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
</span><span id="__span-72-16"><a id="__codelineno-72-16" name="__codelineno-72-16" href="#__codelineno-72-16"></a>        <span class="k">return</span> <span class="n">response</span><span class="o">.</span><span class="n">sum</span>
</span><span id="__span-72-17"><a id="__codelineno-72-17" name="__codelineno-72-17" href="#__codelineno-72-17"></a>    <span class="c1">#如果服务调用失败，rospy.ServiceException会抛出异常</span>
</span><span id="__span-72-18"><a id="__codelineno-72-18" name="__codelineno-72-18" href="#__codelineno-72-18"></a>    <span class="k">except</span> <span class="n">rospy</span><span class="o">.</span><span class="n">ServiceException</span> <span class="k">as</span> <span class="n">e</span><span class="err">：</span>
</span><span id="__span-72-19"><a id="__codelineno-72-19" name="__codelineno-72-19" href="#__codelineno-72-19"></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Service call failed： </span><span class="si">%s</span><span class="s2">&quot;</span><span class="o">%</span><span class="n">e</span><span class="p">)</span>
</span><span id="__span-72-20"><a id="__codelineno-72-20" name="__codelineno-72-20" href="#__codelineno-72-20"></a>
</span><span id="__span-72-21"><a id="__codelineno-72-21" name="__codelineno-72-21" href="#__codelineno-72-21"></a><span class="k">if</span> <span class="vm">__name__</span>  <span class="s1">&#39;__main__&#39;</span><span class="err">：</span>
</span><span id="__span-72-22"><a id="__codelineno-72-22" name="__codelineno-72-22" href="#__codelineno-72-22"></a>    <span class="c1">#判断命令行参数长度是否为3，（程序名，整数1，整数2）</span>
</span><span id="__span-72-23"><a id="__codelineno-72-23" name="__codelineno-72-23" href="#__codelineno-72-23"></a>    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">)</span>  <span class="mi">3</span><span class="err">：</span>
</span><span id="__span-72-24"><a id="__codelineno-72-24" name="__codelineno-72-24" href="#__codelineno-72-24"></a>        <span class="n">x</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
</span><span id="__span-72-25"><a id="__codelineno-72-25" name="__codelineno-72-25" href="#__codelineno-72-25"></a>        <span class="n">y</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
</span><span id="__span-72-26"><a id="__codelineno-72-26" name="__codelineno-72-26" href="#__codelineno-72-26"></a>    <span class="k">else</span><span class="err">：</span>
</span><span id="__span-72-27"><a id="__codelineno-72-27" name="__codelineno-72-27" href="#__codelineno-72-27"></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Only accepted two parameters&quot;</span><span class="p">)</span>
</span><span id="__span-72-28"><a id="__codelineno-72-28" name="__codelineno-72-28" href="#__codelineno-72-28"></a>        <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</span><span id="__span-72-29"><a id="__codelineno-72-29" name="__codelineno-72-29" href="#__codelineno-72-29"></a>    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Requesting </span><span class="si">%s</span><span class="s2"> + </span><span class="si">%s</span><span class="s2">&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">))</span>
</span><span id="__span-72-30"><a id="__codelineno-72-30" name="__codelineno-72-30" href="#__codelineno-72-30"></a>    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> + </span><span class="si">%s</span><span class="s2"> = </span><span class="si">%s</span><span class="s2">&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">add_two_ints_client</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)))</span>
</span></code></pre></div>
<p>运行add_two_ints_client节点：</p>
<div class="language-shell highlight"><pre><span></span><code><span id="__span-73-1"><a id="__codelineno-73-1" name="__codelineno-73-1" href="#__codelineno-73-1"></a>vkrobot@vkrobot：~$<span class="w"> </span>rosrun<span class="w"> </span>vkrobot_tutorials<span class="w"> </span>add_two_ints_client.py<span class="w"> </span><span class="m">2</span><span class="w"> </span><span class="m">3</span>
</span><span id="__span-73-2"><a id="__codelineno-73-2" name="__codelineno-73-2" href="#__codelineno-73-2"></a>Requesting<span class="w"> </span><span class="m">2</span><span class="w"> </span>+<span class="w"> </span><span class="m">3</span>
</span><span id="__span-73-3"><a id="__codelineno-73-3" name="__codelineno-73-3" href="#__codelineno-73-3"></a><span class="m">2</span><span class="w"> </span>+<span class="w"> </span><span class="nv">3</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">5</span>
</span></code></pre></div>
<blockquote>
<p>⚠⚠⚠确保ROS Master与server节点已启动</p>
</blockquote>
<h4 id="_9">练习</h4>
<p>已知小海龟节点提供了<code>/spawn</code>服务，请编写代码调用此服务：smiley：</p>
<p><code>turtle_spawn.py</code></p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-74-1"><a id="__codelineno-74-1" name="__codelineno-74-1" href="#__codelineno-74-1"></a><span class="ch">#! /usr/bin/env python3</span>
</span><span id="__span-74-2"><a id="__codelineno-74-2" name="__codelineno-74-2" href="#__codelineno-74-2"></a>
</span><span id="__span-74-3"><a id="__codelineno-74-3" name="__codelineno-74-3" href="#__codelineno-74-3"></a><span class="kn">import</span> <span class="nn">rospy</span>
</span><span id="__span-74-4"><a id="__codelineno-74-4" name="__codelineno-74-4" href="#__codelineno-74-4"></a><span class="kn">from</span> <span class="nn">turtlesim.srv</span> <span class="kn">import</span> <span class="n">Spawn</span><span class="p">,</span> <span class="n">SpawnRequest</span>
</span><span id="__span-74-5"><a id="__codelineno-74-5" name="__codelineno-74-5" href="#__codelineno-74-5"></a><span class="kn">import</span> <span class="nn">sys</span>
</span><span id="__span-74-6"><a id="__codelineno-74-6" name="__codelineno-74-6" href="#__codelineno-74-6"></a>
</span><span id="__span-74-7"><a id="__codelineno-74-7" name="__codelineno-74-7" href="#__codelineno-74-7"></a><span class="k">def</span> <span class="nf">turtle_spawn_client</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">theta</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span><span class="err">：</span>
</span><span id="__span-74-8"><a id="__codelineno-74-8" name="__codelineno-74-8" href="#__codelineno-74-8"></a>    <span class="n">rospy</span><span class="o">.</span><span class="n">wait_for_service</span><span class="p">(</span><span class="s1">&#39;spawn&#39;</span><span class="p">)</span>
</span><span id="__span-74-9"><a id="__codelineno-74-9" name="__codelineno-74-9" href="#__codelineno-74-9"></a>    <span class="k">try</span><span class="err">：</span>
</span><span id="__span-74-10"><a id="__codelineno-74-10" name="__codelineno-74-10" href="#__codelineno-74-10"></a>        <span class="n">turtle_spawn</span> <span class="o">=</span> <span class="n">rospy</span><span class="o">.</span><span class="n">ServiceProxy</span><span class="p">(</span><span class="s1">&#39;spawn&#39;</span><span class="p">,</span> <span class="n">Spawn</span><span class="p">)</span>
</span><span id="__span-74-11"><a id="__codelineno-74-11" name="__codelineno-74-11" href="#__codelineno-74-11"></a>        <span class="n">response</span> <span class="o">=</span> <span class="n">turtle_spawn</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">theta</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
</span><span id="__span-74-12"><a id="__codelineno-74-12" name="__codelineno-74-12" href="#__codelineno-74-12"></a>        <span class="k">return</span> <span class="n">response</span><span class="o">.</span><span class="n">name</span>
</span><span id="__span-74-13"><a id="__codelineno-74-13" name="__codelineno-74-13" href="#__codelineno-74-13"></a>
</span><span id="__span-74-14"><a id="__codelineno-74-14" name="__codelineno-74-14" href="#__codelineno-74-14"></a>    <span class="k">except</span> <span class="n">rospy</span><span class="o">.</span><span class="n">ServiceException</span> <span class="k">as</span> <span class="n">e</span><span class="err">：</span>
</span><span id="__span-74-15"><a id="__codelineno-74-15" name="__codelineno-74-15" href="#__codelineno-74-15"></a>        <span class="n">rospy</span><span class="o">.</span><span class="n">loginfo</span><span class="p">(</span><span class="s2">&quot;Service call failed： </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">e</span><span class="p">)</span>
</span><span id="__span-74-16"><a id="__codelineno-74-16" name="__codelineno-74-16" href="#__codelineno-74-16"></a>
</span><span id="__span-74-17"><a id="__codelineno-74-17" name="__codelineno-74-17" href="#__codelineno-74-17"></a><span class="k">if</span> <span class="vm">__name__</span>  <span class="s1">&#39;__main__&#39;</span><span class="err">：</span>
</span><span id="__span-74-18"><a id="__codelineno-74-18" name="__codelineno-74-18" href="#__codelineno-74-18"></a>    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">)</span>  <span class="mi">5</span><span class="err">：</span>
</span><span id="__span-74-19"><a id="__codelineno-74-19" name="__codelineno-74-19" href="#__codelineno-74-19"></a>        <span class="n">x</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
</span><span id="__span-74-20"><a id="__codelineno-74-20" name="__codelineno-74-20" href="#__codelineno-74-20"></a>        <span class="n">y</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
</span><span id="__span-74-21"><a id="__codelineno-74-21" name="__codelineno-74-21" href="#__codelineno-74-21"></a>        <span class="n">theta</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span>
</span><span id="__span-74-22"><a id="__codelineno-74-22" name="__codelineno-74-22" href="#__codelineno-74-22"></a>        <span class="n">name</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">4</span><span class="p">])</span>
</span><span id="__span-74-23"><a id="__codelineno-74-23" name="__codelineno-74-23" href="#__codelineno-74-23"></a>    <span class="k">else</span><span class="err">：</span>
</span><span id="__span-74-24"><a id="__codelineno-74-24" name="__codelineno-74-24" href="#__codelineno-74-24"></a>        <span class="n">rospy</span><span class="o">.</span><span class="n">loginfo</span><span class="p">(</span><span class="s2">&quot;Only accepted four parameters.&quot;</span><span class="p">)</span>
</span><span id="__span-74-25"><a id="__codelineno-74-25" name="__codelineno-74-25" href="#__codelineno-74-25"></a>        <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</span><span id="__span-74-26"><a id="__codelineno-74-26" name="__codelineno-74-26" href="#__codelineno-74-26"></a>    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Spawning </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">turtle_spawn_client</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">theta</span><span class="p">,</span> <span class="n">name</span><span class="p">))</span>
</span></code></pre></div>



  



                
              </article>
            </div>
          
          
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12Z"/></svg>
            回到页面顶部
          </button>
        
      </main>
      
        <footer class="md-footer">
  
    
      
        
      
      <nav class="md-footer__inner md-grid" aria-label="页脚" >
        
        
          
          <a href="../ROS%E8%BF%9B%E9%98%B6/" class="md-footer__link md-footer__link--next" aria-label="下一页: ROS进阶" rel="next">
            <div class="md-footer__title">
              <span class="md-footer__direction">
                下一页
              </span>
              <div class="md-ellipsis">
                ROS进阶
              </div>
            </div>
            <div class="md-footer__button md-icon">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4Z"/></svg>
            </div>
          </a>
        
      </nav>
    
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      Copyright &copy; 2023 VK-Robot
    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
        <div class="md-social">
  
    
    
      
    
    
    
    <a href="http://www.vk-robot.com/" target="_blank" rel="noopener me" title="官网" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.4.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M433 179.11c0-97.2-63.71-125.7-63.71-125.7-62.52-28.7-228.56-28.4-290.48 0 0 0-63.72 28.5-63.72 125.7 0 115.7-6.6 259.4 105.63 289.1 40.51 10.7 75.32 13 103.33 11.4 50.81-2.8 79.32-18.1 79.32-18.1l-1.7-36.9s-36.31 11.4-77.12 10.1c-40.41-1.4-83-4.4-89.63-54a102.54 102.54 0 0 1-.9-13.9c85.63 20.9 158.65 9.1 178.75 6.7 56.12-6.7 105-41.3 111.23-72.9 9.8-49.8 9-121.5 9-121.5zm-75.12 125.2h-46.63v-114.2c0-49.7-64-51.6-64 6.9v62.5h-46.33V197c0-58.5-64-56.6-64-6.9v114.2H90.19c0-122.1-5.2-147.9 18.41-175 25.9-28.9 79.82-30.8 103.83 6.1l11.6 19.5 11.6-19.5c24.11-37.1 78.12-34.8 103.83-6.1 23.71 27.3 18.4 53 18.4 175z"/></svg>
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
      <div class="md-consent" data-md-component="consent" id="__consent" hidden>
        <div class="md-consent__overlay"></div>
        <aside class="md-consent__inner">
          <form class="md-consent__form md-grid md-typeset" name="consent">
            




  


<h4>Cookie consent</h4>
<p>We use cookies to recognize your repeated visits and preferences, as well as to measure the effectiveness of our documentation and whether users find what they're searching for. With your consent, you're helping us to make our documentation better.</p>
<input class="md-toggle" type="checkbox" id="__settings" >
<div class="md-consent__settings">
  <ul class="task-list">
    
  </ul>
</div>
<div class="md-consent__controls">
  
    
      <button class="md-button md-button--primary">同意</button>
    
    
    
  
    
    
    
      <label class="md-button" for="__settings">管理设定</label>
    
  
</div>
          </form>
        </aside>
      </div>
      <script>var consent=__md_get("__consent");if(consent)for(var input of document.forms.consent.elements)input.name&&(input.checked=consent[input.name]||!1);else"file:"!==location.protocol&&setTimeout(function(){document.querySelector("[data-md-component=consent]").hidden=!1},250);var action,form=document.forms.consent;for(action of["submit","reset"])form.addEventListener(action,function(e){if(e.preventDefault(),"reset"===e.type)for(var n of document.forms.consent.elements)n.name&&(n.checked=!1);__md_set("__consent",Object.fromEntries(Array.from(new FormData(form).keys()).map(function(e){return[e,!0]}))),location.hash="",location.reload()})</script>
    
    <script id="__config" type="application/json">{"base": "..", "features": ["navigation.instant", "navigation.instant.prefetch", "navigation.tracking", "navigation.sections", "navigation.expand", "navigation.path", "navigation.footer", "navigation.indexes", "navigation.prune", "navigation.top", "content.code.copy", "content.code.select", "content.code.annotate", "toc.follow"], "search": "../assets/javascripts/workers/search.74e28a9f.min.js", "translations": {"clipboard.copied": "\u5df2\u590d\u5236", "clipboard.copy": "\u590d\u5236", "search.result.more.one": "\u5728\u8be5\u9875\u4e0a\u8fd8\u6709 1 \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.more.other": "\u5728\u8be5\u9875\u4e0a\u8fd8\u6709 # \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.none": "\u6ca1\u6709\u627e\u5230\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.one": "\u627e\u5230 1 \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.other": "# \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.placeholder": "\u952e\u5165\u4ee5\u5f00\u59cb\u641c\u7d22", "search.result.term.missing": "\u7f3a\u5c11", "select.version": "\u9009\u62e9\u5f53\u524d\u7248\u672c"}}</script>
    
    
      <script src="../assets/javascripts/bundle.220ee61c.min.js"></script>
      
    
  </body>
</html>